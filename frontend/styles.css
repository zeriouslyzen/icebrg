/* ICEBURG 2.0 - Mobile-First Futuristic UI */
/* Black/White Foundation with Morphing Animations */

:root {
    --bg-primary: #000000;
    --bg-secondary: #0a0a0a;
    --bg-tertiary: #111111;
    --bg-elevated: #1a1a1a;
    --text-primary: #ffffff;
    --text-secondary: #cccccc;
    --text-tertiary: #888888;
    --border-primary: #333333;
    --border-secondary: #222222;
    --accent-primary: #ffffff;
    --accent-secondary: #666666;
    --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.5);
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-base: 300ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
    --morph-duration: 800ms;
}

/* Light Mode - TRUE INVERSION: white->black, black->white */
body.light-mode {
    --bg-primary: #ffffff;
    --bg-secondary: #fafafa;
    --bg-tertiary: #f5f5f5;
    --bg-elevated: #f0f0f0;
    --text-primary: #000000;
    --text-secondary: #000000;
    --text-tertiary: #333333;
    --border-primary: #000000;
    --border-secondary: #333333;
    --accent-primary: #000000;
    --accent-secondary: #000000;
    --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);
    --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.25);
    --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.3);
}

/* Light mode: Invert neural network/stars to black */
body.light-mode .neural-network-canvas {
    filter: invert(1);
}

/* Light mode: Black pulsing orbs with black glow */
body.light-mode .pulsing-ball-icon {
    background-color: #000000;
    box-shadow:
        0 0 8px rgba(0, 0, 0, 0.8),
        0 0 16px rgba(0, 0, 0, 0.6),
        0 0 24px rgba(0, 0, 0, 0.4);
    animation: ball-pulse-light 2s ease-in-out infinite;
}

@keyframes ball-pulse-light {

    0%,
    100% {
        transform: scale(1);
        opacity: 0.9;
        box-shadow:
            0 0 8px rgba(0, 0, 0, 0.8),
            0 0 16px rgba(0, 0, 0, 0.6);
    }

    50% {
        transform: scale(1.1);
        opacity: 1;
        box-shadow:
            0 0 12px rgba(0, 0, 0, 1),
            0 0 24px rgba(0, 0, 0, 0.8),
            0 0 32px rgba(0, 0, 0, 0.5);
    }
}

/* Light mode: Black glowing title */
body.light-mode .app-title {
    color: #000000;
    text-shadow:
        0 0 10px rgba(0, 0, 0, 0.5),
        0 0 20px rgba(0, 0, 0, 0.3),
        0 0 30px rgba(0, 0, 0, 0.2);
    animation: iceberg-pulse-light 3s ease-in-out infinite;
}

@keyframes iceberg-pulse-light {

    0%,
    100% {
        text-shadow:
            0 0 10px rgba(0, 0, 0, 0.5),
            0 0 20px rgba(0, 0, 0, 0.3),
            0 0 30px rgba(0, 0, 0, 0.2);
    }

    50% {
        text-shadow:
            0 0 15px rgba(0, 0, 0, 0.7),
            0 0 25px rgba(0, 0, 0, 0.5),
            0 0 35px rgba(0, 0, 0, 0.3);
    }
}

/* Light mode: Agent workflow pill */
body.light-mode .agent-workflow-pill {
    background: rgba(255, 255, 255, 0.95);
    border-color: #000000;
}

body.light-mode .agent-step {
    color: #000000;
}

body.light-mode .agent-step.active {
    color: #000000;
}

body.light-mode .agent-step-icon {
    background: #000000;
}

body.light-mode .agent-step.active .agent-step-icon {
    background: #000000;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.8), 0 0 16px rgba(0, 0, 0, 0.5);
}

body.light-mode .agent-step-arrow {
    color: #000000;
}

/* Light mode: Meteor shower / shooting stars inverted */
body.light-mode .meteor-shower-canvas {
    filter: invert(1);
}

/* Light mode: Input area */
body.light-mode .input-area {
    background: #ffffff;
    border-color: #000000;
}

body.light-mode .chat-input {
    color: #000000;
    background: #ffffff;
}

body.light-mode .chat-input::placeholder {
    color: #666666;
}

/* Light mode: Messages */
body.light-mode .message.assistant {
    color: #000000;
}

body.light-mode .message.user {
    color: #000000;
}

/* Light mode: Settings panel */
body.light-mode .settings-panel {
    background: rgba(255, 255, 255, 0.98);
    border-color: #000000;
}

body.light-mode .settings-header {
    border-color: #000000;
}

/* Light mode: Controls panel */
body.light-mode .controls-panel {
    background: #ffffff;
    border-color: #000000;
}

body.light-mode .control-select {
    background: #ffffff;
    color: #000000;
    border-color: #000000;
}

/* Light mode: Sidebar */
body.light-mode .sidebar {
    background: #ffffff;
    border-color: #000000;
}

/* Light mode: Heavier fonts for readability (optimal black-on-white typography) */
body.light-mode {
    font-weight: 450;
    -webkit-font-smoothing: auto;
    /* Better for black on white */
}

body.light-mode p,
body.light-mode span,
body.light-mode div {
    font-weight: 450;
}

body.light-mode h1,
body.light-mode h2,
body.light-mode h3 {
    font-weight: 600;
}

body.light-mode .message-content {
    font-weight: 450;
    letter-spacing: 0.01em;
    /* Slight spacing for readability */
}

body.light-mode .welcome-message p {
    font-weight: 600;
}

body.light-mode .welcome-subtitle {
    font-weight: 450;
    line-height: 1.7;
}

/* Light mode: Pure white header - NO glassmorphism */
body.light-mode .app-header {
    background-color: #ffffff !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    border-bottom: 1px solid #000000;
}

/* Light mode: Pure white input container - NO glassmorphism */
body.light-mode .input-container {
    background-color: #ffffff !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    border-top: 1px solid #000000;
}

/* Light mode: Blacker shooting stars with visible glow */
body.light-mode .meteor-shower-canvas {
    filter: invert(1) contrast(1.5);
    opacity: 0.4;
}

/* Light mode: Override any canvas drawing to be black */
body.light-mode canvas {
    filter: invert(1);
}

/* Light mode: Ensure neural network is visible black */
body.light-mode .neural-network-canvas {
    filter: invert(1) contrast(1.3);
    opacity: 0.25;
}

/* Light mode: Encyclopedia button - black with white text */
body.light-mode .encyclopedia-link {
    background: #000000 !important;
    color: #ffffff !important;
    border-color: #000000 !important;
}

body.light-mode .encyclopedia-link:hover {
    background: #222222 !important;
}

/* Light mode: Mode and Agent selectors - black with white text */
body.light-mode .control-select {
    background: #000000 !important;
    color: #ffffff !important;
    border-color: #000000 !important;
}

body.light-mode .control-select option {
    background: #000000;
    color: #ffffff;
}

body.light-mode .control-label {
    color: #000000;
    font-weight: 600;
}

/* Light mode: Hide carousel arrow buttons completely */
body.light-mode .prompt-carousel-prev,
body.light-mode .prompt-carousel-next {
    display: none !important;
}

/* Light mode: Prompt carousel - black background with white text */
body.light-mode .prompt-carousel {
    background: #000000 !important;
    border-color: #000000 !important;
}

body.light-mode .prompt-item {
    color: #ffffff !important;
}

body.light-mode .prompt-carousel-content {
    color: #ffffff;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Modular container base styles */
.actionable-modular,
.conclusion-modular {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin: 0.25rem 0;
    padding: 0.5rem;
    max-width: 100%;
    box-sizing: border-box;
}

.actionable-modular-item,
.conclusion-modular-item {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    font-size: 0.6875rem;
    line-height: 1.2;
    color: var(--text-secondary);
    max-width: 300px;
    word-wrap: break-word;
    box-sizing: border-box;
    margin: 0;
}

html {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    scroll-behavior: smooth;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', 'Segoe UI', 'Roboto', 'Arial', sans-serif;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
    min-height: 100vh;
    min-height: 100dvh;
    min-height: -webkit-fill-available;
    /* Safari fix */
    position: relative;
    margin: 0;
    padding: 0;
    /* Safari viewport fix - no gaps */
    padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
}

/* Neural Network Background */
.neural-network-canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    pointer-events: none;
    opacity: 0.15;
    transition: opacity var(--transition-base);
}

.neural-network-canvas.active {
    opacity: 0.25;
}

/* Hide neural network background behind chat container */
.chat-container {
    position: relative;
    z-index: 1;
}

.chat-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bg-primary);
    z-index: -1;
    pointer-events: none;
}

/* App Container */
.app-container {
    display: flex;
    min-height: 100vh;
    min-height: 100dvh;
    min-height: -webkit-fill-available;
    /* Safari fix */
    position: relative;
    z-index: 1;
    background-color: transparent;
    width: 100%;
    margin: 0;
    padding: 0;
    /* Safari safe area support */
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
    box-sizing: border-box;
}

/* Header */
.app-header {
    position: sticky;
    top: 0;
    z-index: 100;
    background-color: var(--bg-primary);
    border-bottom: 1px solid var(--border-primary);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    background-color: rgba(0, 0, 0, 0.8);
    padding: 1rem 1.25rem;
    padding-top: calc(1rem + env(safe-area-inset-top));
    /* Safari notch support */
    transition: all var(--transition-base);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    width: 100%;
    box-sizing: border-box;
    margin: 0;
}

.header-content {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    flex: 1;
}

.settings-toggle {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
}

.settings-toggle:hover {
    background-color: var(--bg-elevated);
    color: var(--text-primary);
}

/* Pulsing Ball Icon */
.pulsing-ball-icon {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.9);
    box-shadow:
        0 0 8px rgba(255, 255, 255, 0.6),
        0 0 16px rgba(255, 255, 255, 0.4);
    animation: ball-pulse 2s ease-in-out infinite;
    transition: all var(--transition-fast);
}

.pulsing-ball-icon:hover {
    background-color: rgba(255, 255, 255, 1);
    box-shadow:
        0 0 12px rgba(255, 255, 255, 0.8),
        0 0 24px rgba(255, 255, 255, 0.6);
}

@keyframes ball-pulse {

    0%,
    100% {
        transform: scale(1);
        opacity: 0.9;
        box-shadow:
            0 0 8px rgba(255, 255, 255, 0.6),
            0 0 16px rgba(255, 255, 255, 0.4);
    }

    50% {
        transform: scale(1.1);
        opacity: 1;
        box-shadow:
            0 0 12px rgba(255, 255, 255, 0.8),
            0 0 24px rgba(255, 255, 255, 0.6),
            0 0 32px rgba(255, 255, 255, 0.3);
    }
}

/* Color shift animation for ball */
@keyframes ball-color-shift {

    0%,
    100% {
        background-color: rgba(255, 255, 255, 0.9);
        box-shadow:
            0 0 8px rgba(255, 255, 255, 0.6),
            0 0 16px rgba(255, 255, 255, 0.4);
    }

    25% {
        background-color: rgba(240, 248, 255, 0.95);
        box-shadow:
            0 0 8px rgba(240, 248, 255, 0.7),
            0 0 16px rgba(240, 248, 255, 0.5);
    }

    50% {
        background-color: rgba(230, 240, 255, 0.95);
        box-shadow:
            0 0 8px rgba(230, 240, 255, 0.7),
            0 0 16px rgba(230, 240, 255, 0.5);
    }

    75% {
        background-color: rgba(240, 248, 255, 0.95);
        box-shadow:
            0 0 8px rgba(240, 248, 255, 0.7),
            0 0 16px rgba(240, 248, 255, 0.5);
    }
}

.pulsing-ball-icon {
    animation: ball-pulse 2s ease-in-out infinite, ball-color-shift 4s ease-in-out infinite;
}

.app-title {
    font-size: 1.5rem;
    font-weight: 600;
    letter-spacing: -0.02em;
    color: var(--text-primary);
    margin: 0;
    line-height: 1.2;
    /* Neon light blue glow with pulsing */
    text-shadow:
        0 0 10px rgba(135, 206, 250, 0.5),
        0 0 20px rgba(135, 206, 250, 0.3),
        0 0 30px rgba(135, 206, 250, 0.2);
    animation: iceberg-pulse 3s ease-in-out infinite;
}

@keyframes iceberg-pulse {

    0%,
    100% {
        text-shadow:
            0 0 10px rgba(135, 206, 250, 0.5),
            0 0 20px rgba(135, 206, 250, 0.3),
            0 0 30px rgba(135, 206, 250, 0.2);
        opacity: 1;
    }

    50% {
        text-shadow:
            0 0 15px rgba(135, 206, 250, 0.7),
            0 0 25px rgba(135, 206, 250, 0.5),
            0 0 35px rgba(135, 206, 250, 0.3);
        opacity: 0.95;
    }
}

.app-subtitle {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-weight: 400;
    letter-spacing: 0.01em;
    margin: 0;
}

/* Main Content */
.app-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 0;
    overflow: hidden;
}

/* Chat Container */
.chat-container {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 1.25rem 1rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    /* Allow animations to overflow without clipping */
    contain: layout style;
    position: relative;
    width: 100%;
    box-sizing: border-box;
    /* Safari safe area - no gaps */
    padding-left: calc(1rem + env(safe-area-inset-left));
    padding-right: calc(1rem + env(safe-area-inset-right));
}

/* Meteor Shower Background for Chat */
.meteor-shower-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    pointer-events: none;
    opacity: 0.3;
}

.chat-container::-webkit-scrollbar {
    width: 4px;
}

.chat-container::-webkit-scrollbar-track {
    background: transparent;
}

.chat-container::-webkit-scrollbar-thumb {
    background: var(--border-primary);
    border-radius: 2px;
}

/* Welcome Message */
.welcome-message {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex: 1;
    text-align: center;
    padding: 2rem 1rem;
    color: var(--text-secondary);
    position: relative;
    z-index: 1;
}

.welcome-message p {
    font-size: 1rem;
    margin-bottom: 0.5rem;
}

.welcome-subtitle {
    font-size: 0.875rem;
    color: var(--text-tertiary);
}

/* Messages */
.message {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 0.75rem 0;
    /* Minimal padding, no borders */
    border-radius: 0;
    /* No rounded corners */
    background-color: transparent;
    /* No background */
    border: none;
    /* No borders */
    animation: messageMorphIn var(--morph-duration) cubic-bezier(0.4, 0, 0.2, 1);
    transition: opacity var(--transition-base), transform var(--transition-base);
    position: relative;
    z-index: 1;
    overflow: visible;
    /* Allow overflow for animations */
    will-change: transform, opacity;
    /* Optimize animations */
}

.message::before {
    display: none;
    /* Remove gradient line */
}

/* Slide-up Panel (ICEBURG style) - Glassmorphism */
.thoughts-slide-up {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    max-height: 70vh;
    background: rgba(0, 0, 0, 0.85);
    /* Glassmorphism background */
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px 16px 0 0;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
    overflow-y: auto;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
}

.thoughts-slide-up.open {
    transform: translateY(0);
}

.thoughts-slide-up-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: sticky;
    top: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    z-index: 10;
}

.thoughts-slide-up-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
}

.thoughts-slide-up-close {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.thoughts-slide-up-close:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
}

.thoughts-slide-up-content {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.thoughts-slide-up-section {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.thoughts-slide-up-section-title {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.25rem;
}

.thoughts-slide-up-item {
    font-size: 0.8125rem;
    color: var(--text-primary);
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    border-left: 2px solid rgba(255, 255, 255, 0.2);
    animation: slideUpItem 0.3s ease;
}

@keyframes slideUpItem {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.thoughts-slide-up-bullet {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    padding: 0.375rem 0;
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.thoughts-slide-up-bullet::before {
    content: '•';
    color: var(--accent-primary);
    font-weight: bold;
    margin-top: 0.125rem;
}

/* Thoughts Button - Small trigger button */
.thoughts-trigger {
    position: absolute;
    top: 0.25rem;
    /* Position at top right */
    right: 0.25rem;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 20px;
    padding: 0.25rem 0.5rem;
    font-size: 0.625rem;
    color: var(--text-secondary);
    cursor: pointer;
    display: flex !important;
    /* Force visibility */
    align-items: center;
    gap: 0.25rem;
    transition: all 0.2s ease;
    z-index: 1000;
    /* Higher z-index to prevent covering */
    visibility: visible !important;
    /* Force visibility */
    opacity: 1 !important;
    /* Force visibility */
    pointer-events: auto !important;
    /* Ensure clickable */
}

.thoughts-trigger:hover {
    background: rgba(255, 255, 255, 0.15);
    color: var(--text-primary);
    border-color: rgba(255, 255, 255, 0.25);
}

.thoughts-trigger-icon {
    width: 12px;
    height: 12px;
    transition: transform 0.2s ease;
}

.thoughts-trigger.active .thoughts-trigger-icon {
    transform: rotate(180deg);
}

.message.user {
    background-color: transparent;
    /* No background */
    border: none;
    /* No borders */
    align-self: flex-start;
    /* Left aligned */
    max-width: 100%;
    width: 100%;
    margin-left: 0;
    /* Left aligned */
}

.message.assistant {
    background-color: transparent;
    /* No background */
    border: none;
    /* No borders */
    align-self: flex-start;
    /* Left aligned */
    max-width: 100%;
    /* Full width for assistant messages */
    width: 100%;
    /* Full width */
    box-sizing: border-box;
    /* Include padding in width */
    position: relative;
    /* Needed for absolute positioning of thoughts trigger */
}

.message-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-weight: 500;
    letter-spacing: 0.01em;
}

.message-content {
    font-size: 0.875rem;
    line-height: 1.4;
    /* Tighter line height for aesthetic stacking */
    color: var(--text-primary);
    word-wrap: break-word;
    white-space: pre-wrap;
    margin-bottom: 0.5rem;
    /* Tighter spacing */
    /* Remove conflicting transitions - let animations handle it */
    transition: color var(--transition-fast);
}

/* Thinking Display */
.thinking-display {
    margin-top: 0.75rem;
    padding: 1rem;
    background-color: var(--bg-tertiary);
    border-left: 2px solid var(--accent-secondary);
    border-radius: 8px;
    animation: thinkingMorphIn var(--transition-slow) cubic-bezier(0.4, 0, 0.2, 1);
}

.thinking-display strong {
    display: block;
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.01em;
}

.thinking-item {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
    padding-left: 1rem;
    position: relative;
    line-height: 1.5;
    animation: thinkingItemMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
}

.thinking-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0.5em;
    width: 4px;
    height: 4px;
    background-color: var(--accent-secondary);
    border-radius: 50%;
    transform: scale(0);
    animation: thinkingDotMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.thinking-item:last-child {
    margin-bottom: 0;
}

/* Informatics Panel */
.informatics-panel {
    margin-top: 0.75rem;
    padding: 1rem;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    animation: informaticsMorphIn var(--transition-slow) cubic-bezier(0.4, 0, 0.2, 1);
}

.informatics-panel strong {
    display: block;
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.01em;
}

.informatics-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-bottom: 0.75rem;
    padding: 0.75rem;
    background-color: var(--bg-secondary);
    border-radius: 6px;
    transition: all var(--transition-fast);
}

.informatics-item:last-child {
    margin-bottom: 0;
}

.informatics-item:hover {
    background-color: var(--bg-elevated);
    transform: translateX(2px);
}

.informatics-label {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.informatics-value {
    font-size: 0.875rem;
    color: var(--text-primary);
    word-break: break-word;
}

.confidence-bar {
    display: inline-block;
    width: 80px;
    height: 3px;
    background-color: var(--border-primary);
    border-radius: 2px;
    margin-left: 0.5rem;
    vertical-align: middle;
    overflow: hidden;
}

.confidence-fill {
    height: 100%;
    background-color: var(--accent-primary);
    border-radius: 2px;
    transition: width var(--transition-slow) cubic-bezier(0.4, 0, 0.2, 1);
    animation: confidenceMorphIn var(--transition-slow) cubic-bezier(0.4, 0, 0.2, 1);
}

/* Conclusion Bullets */
.conclusion-bullets {
    margin-top: 0.75rem;
    padding: 1rem;
    background-color: var(--bg-tertiary);
    border-left: 2px solid var(--accent-primary);
    border-radius: 8px;
    animation: conclusionMorphIn var(--transition-slow) cubic-bezier(0.4, 0, 0.2, 1);
}

.conclusion-bullets h3 {
    font-size: 0.8125rem;
    color: var(--text-primary);
    margin-bottom: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.01em;
}

.conclusion-item {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
    padding-left: 1.25rem;
    position: relative;
    line-height: 1.5;
    animation: conclusionItemMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
}

.conclusion-item::before {
    content: '→';
    position: absolute;
    left: 0;
    color: var(--accent-primary);
    font-weight: 600;
    transform: translateX(-4px);
    animation: arrowMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.conclusion-item:last-child {
    margin-bottom: 0;
}

/* Prompt Carousel */
.prompt-carousel {
    position: relative;
    width: 100%;
    margin-bottom: 0.75rem;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    overflow: hidden;
    min-height: 48px;
    display: flex;
    align-items: center;
    transition: all var(--transition-base);
    visibility: visible !important;
    opacity: 1 !important;
}

.prompt-carousel:hover {
    border-color: var(--border-secondary);
    background-color: var(--bg-tertiary);
}

.prompt-carousel-content {
    flex: 1;
    padding: 0.75rem 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 48px;
    position: relative;
    /* Required for absolute positioning of prompt-item */
    overflow-x: hidden;
    /* Changed from auto to hidden to prevent scrolling */
    overflow-y: hidden;
    visibility: visible !important;
    opacity: 1 !important;
    scrollbar-width: thin;
    -webkit-overflow-scrolling: touch;
}

.prompt-item {
    position: absolute;
    width: 100%;
    text-align: center;
    padding: 0 1rem;
    opacity: 0;
    transform: translateX(20px);
    transition: all var(--morph-duration) cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
    font-size: 0.875rem;
    color: var(--text-secondary);
    cursor: pointer;
    user-select: none;
    visibility: visible !important;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.prompt-item.active {
    opacity: 1;
    transform: translateX(0);
    pointer-events: auto;
    visibility: visible !important;
    z-index: 10;
}

.prompt-item:hover {
    color: var(--text-primary);
}

.prompt-carousel-prev,
.prompt-carousel-next {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    opacity: 0.5;
}

.prompt-carousel-prev {
    left: 0.5rem;
}

.prompt-carousel-next {
    right: 0.5rem;
}

.prompt-carousel:hover .prompt-carousel-prev,
.prompt-carousel:hover .prompt-carousel-next {
    opacity: 1;
}

.prompt-carousel-prev:hover,
.prompt-carousel-next:hover {
    background-color: var(--bg-elevated);
    color: var(--text-primary);
}

.prompt-carousel-prev:active,
.prompt-carousel-next:active {
    transform: translateY(-50%) scale(0.95);
}

/* Input Container */
.input-container {
    position: sticky;
    bottom: 0;
    z-index: 100;
    background-color: var(--bg-primary);
    border-top: 1px solid var(--border-primary);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    background-color: rgba(0, 0, 0, 0.8);
    padding: 1rem 1.25rem;
    padding-bottom: max(1rem, env(safe-area-inset-bottom));
    padding-left: calc(1.25rem + env(safe-area-inset-left));
    padding-right: calc(1.25rem + env(safe-area-inset-right));
    width: 100%;
    box-sizing: border-box;
    margin: 0;
    /* Safari fix - ensure no gaps */
    left: 0;
    right: 0;
}

.input-wrapper {
    display: flex;
    gap: 0.75rem;
    align-items: flex-end;
    max-width: 100%;
}

.attach-button {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    width: 44px;
    height: 44px;
    min-width: 44px;
}

.attach-button:hover {
    background-color: var(--bg-elevated);
    color: var(--text-primary);
}

.voice-button {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    width: 44px;
    height: 44px;
    min-width: 44px;
    position: relative;
}

.voice-button:hover {
    background-color: var(--bg-elevated);
    color: var(--text-primary);
}

.voice-button.recording {
    color: #ff4444;
    animation: pulse 1.5s ease-in-out infinite;
}

.voice-button.recording::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: rgba(255, 68, 68, 0.2);
    animation: ripple 1.5s ease-out infinite;
}

@keyframes pulse {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.6;
    }
}

@keyframes ripple {
    0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0.8;
    }

    100% {
        transform: translate(-50%, -50%) scale(1.5);
        opacity: 0;
    }
}

.attached-files {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.75rem;
    padding: 0 0.25rem;
}

.attached-file-item {
    position: relative;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    font-size: 0.8125rem;
    color: var(--text-secondary);
    animation: messageMorphIn var(--transition-base);
}

.attached-file-preview {
    width: 48px;
    height: 48px;
    object-fit: cover;
    border-radius: 6px;
}

.attached-file-remove {
    background: none;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    font-size: 1.25rem;
    line-height: 1;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
}

.attached-file-remove:hover {
    background-color: var(--bg-elevated);
    color: var(--text-primary);
}

.message-files {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--border-primary);
}

.message-file-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    background-color: var(--bg-tertiary);
    border-radius: 6px;
    font-size: 0.8125rem;
    color: var(--text-secondary);
}

.message-file-image {
    max-width: 200px;
    max-height: 200px;
    border-radius: 6px;
    object-fit: contain;
}

.input-field {
    flex: 1;
    padding: 0.875rem 1rem;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    color: var(--text-primary);
    font-family: inherit;
    font-size: 0.9375rem;
    line-height: 1.5;
    transition: all var(--transition-base);
    resize: none;
    min-height: 44px;
    max-height: 120px;
}

.input-field:focus {
    outline: none;
    border-color: var(--accent-primary);
    background-color: var(--bg-tertiary);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
}

.input-field::placeholder {
    color: var(--text-tertiary);
}

.send-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    min-width: 44px;
    background-color: var(--accent-primary);
    color: var(--bg-primary);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all var(--transition-base);
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
}

.send-button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background-color: rgba(0, 0, 0, 0.1);
    transform: translate(-50%, -50%);
    transition: width var(--transition-base), height var(--transition-base);
}

.send-button:hover::before {
    width: 100%;
    height: 100%;
}

.send-button:hover {
    transform: scale(1.05);
    box-shadow: var(--shadow-md);
}

.send-button:active {
    transform: scale(0.95);
}

.send-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.send-button svg {
    width: 20px;
    height: 20px;
    stroke: currentColor;
    transition: transform var(--transition-fast);
}

.send-button:hover svg {
    transform: translateX(2px) translateY(-2px);
}

/* Loading State */
.loading {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid var(--border-primary);
    border-top-color: var(--accent-primary);
    border-radius: 50%;
    animation: spinMorph 0.8s linear infinite;
}

/* Animations */
@keyframes messageMorphIn {
    from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
        filter: blur(4px);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
    }
}

@keyframes thinkingMorphIn {
    from {
        opacity: 0;
        transform: translateX(-10px);
        clip-path: inset(0 100% 0 0);
    }

    to {
        opacity: 1;
        transform: translateX(0);
        clip-path: inset(0 0 0 0);
    }
}

@keyframes thinkingItemMorphIn {
    from {
        opacity: 0;
        transform: translateX(-8px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes thinkingDotMorphIn {
    from {
        transform: scale(0);
    }

    to {
        transform: scale(1);
    }
}

@keyframes informaticsMorphIn {
    from {
        opacity: 0;
        transform: scale(0.98);
        filter: blur(2px);
    }

    to {
        opacity: 1;
        transform: scale(1);
        filter: blur(0);
    }
}

@keyframes conclusionMorphIn {
    from {
        opacity: 0;
        transform: translateX(-10px);
        clip-path: inset(0 0 0 100%);
    }

    to {
        opacity: 1;
        transform: translateX(0);
        clip-path: inset(0 0 0 0);
    }
}

@keyframes conclusionItemMorphIn {
    from {
        opacity: 0;
        transform: translateX(-8px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes arrowMorphIn {
    from {
        transform: translateX(-8px);
        opacity: 0;
    }

    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes confidenceMorphIn {
    from {
        width: 0;
    }
}

@keyframes spinMorph {
    from {
        transform: rotate(0deg);
    }

    to {
        transform: rotate(360deg);
    }
}

/* Mobile Optimizations */
@media (max-width: 768px) {
    .prompt-carousel {
        margin-bottom: 0.5rem;
        min-height: 44px;
    }

    .prompt-carousel-content {
        padding: 0.625rem 2.5rem;
        min-height: 44px;
    }

    .prompt-item {
        font-size: 0.8125rem;
    }

    .prompt-carousel-prev,
    .prompt-carousel-next {
        padding: 0.375rem;
        opacity: 0.7;
    }

    .input-container {
        padding: 0.75rem 1rem;
    }

    .input-wrapper {
        gap: 0.5rem;
    }

    .attach-button,
    .voice-button,
    .send-button {
        width: 40px;
        height: 40px;
        min-width: 40px;
    }

    .input-field {
        font-size: 0.875rem;
        padding: 0.75rem 0.875rem;
        min-height: 40px;
    }

    .sidebar {
        width: 100%;
        max-width: 320px;
    }
}

@media (max-width: 480px) {
    .app-header {
        padding: 0.875rem 1rem;
    }

    .app-title {
        font-size: 1.25rem;
    }

    .app-subtitle {
        font-size: 0.6875rem;
    }

    .prompt-carousel {
        margin-bottom: 0.5rem;
        min-height: 40px;
    }

    .prompt-carousel-content {
        padding: 0.5rem 2rem;
        min-height: 40px;
    }

    .prompt-item {
        font-size: 0.75rem;
    }

    .input-container {
        padding: 0.625rem 0.875rem;
    }

    .input-wrapper {
        gap: 0.375rem;
    }

    .attach-button,
    .voice-button,
    .send-button {
        width: 36px;
        height: 36px;
        min-width: 36px;
        padding: 0.375rem;
    }

    .input-field {
        font-size: 0.8125rem;
        padding: 0.625rem 0.75rem;
        min-height: 36px;
    }

    .chat-container {
        padding: 1rem 0.875rem;
        gap: 1.25rem;
    }

    .message {
        padding: 0.875rem;
        border-radius: 10px;
    }

    .message.user {
        max-width: 90%;
    }

    .message.assistant {
        max-width: 100%;
        /* Full width on mobile */
        width: 100%;
    }

    .input-container {
        padding: 0.875rem 1rem;
    }

    .input-field {
        font-size: 0.875rem;
        padding: 0.75rem 0.875rem;
    }
}

/* Tablet and Desktop */
@media (min-width: 768px) {
    .app-container {
        max-width: 800px;
        margin: 0 auto;
    }

    .app-header {
        padding: 1.25rem 1.5rem;
    }

    .app-title {
        font-size: 1.75rem;
    }

    .chat-container {
        padding: 1.5rem 1.25rem;
    }

    .message {
        max-width: 75%;
    }

    .input-container {
        padding: 1.25rem 1.5rem;
    }
}

/* Large Desktop */
@media (min-width: 1200px) {
    .app-container {
        max-width: 900px;
    }
}

/* Dark Mode Support (already dark, but for system preference) */
@media (prefers-color-scheme: light) {
    /* Keep dark theme regardless */
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {

    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* Focus Visible */
*:focus-visible {
    outline: 2px solid var(--accent-primary);
    outline-offset: 2px;
}

/* Loading Indicator */
.loading-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.loading-dots {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
}

.loading-dots span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: var(--accent-primary);
    animation: loadingDotPulse 1.4s ease-in-out infinite;
}

.loading-dots span:nth-child(1) {
    animation-delay: 0s;
}

.loading-dots span:nth-child(2) {
    animation-delay: 0.2s;
}

.loading-dots span:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes loadingDotPulse {

    0%,
    80%,
    100% {
        opacity: 0.3;
        transform: scale(0.8);
    }

    40% {
        opacity: 1;
        transform: scale(1);
    }
}

/* Selection */
::selection {
    background-color: rgba(255, 255, 255, 0.2);
    color: var(--text-primary);
}

/* Controls Panel */
.controls-panel {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.4) 0%, rgba(10, 10, 10, 0.6) 100%);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: none;
    border-bottom: none;
    animation: controlsMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.controls-panel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.1) 50%, transparent 100%);
    pointer-events: none;
}

.control-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    flex: 1;
    min-width: 120px;
    position: relative;
}

.agent-display {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 0.875rem;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.agent-display-label {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.agent-display-value {
    font-size: 0.875rem;
    color: var(--text-primary);
    font-weight: 600;
    letter-spacing: 0.02em;
}

.control-label {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.control-select {
    padding: 0.625rem 0.875rem;
    background: rgba(255, 255, 255, 0.03);
    border: none;
    border-radius: 8px;
    color: var(--text-primary);
    font-family: inherit;
    font-size: 0.875rem;
    transition: all var(--transition-base);
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.control-select:hover {
    background: rgba(255, 255, 255, 0.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.control-select:focus {
    outline: none;
    background: rgba(255, 255, 255, 0.08);
    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.15), 0 4px 16px rgba(0, 0, 0, 0.4);
}

.control-toggle {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    user-select: none;
}

.control-toggle input[type="checkbox"] {
    display: none;
}

.toggle-slider {
    position: relative;
    width: 44px;
    height: 24px;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    transition: all var(--transition-base);
}

.toggle-slider::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 18px;
    height: 18px;
    background-color: var(--text-tertiary);
    border-radius: 50%;
    transition: all var(--transition-base);
}

.control-toggle input[type="checkbox"]:checked+.toggle-slider {
    background-color: var(--accent-primary);
    border-color: var(--accent-primary);
}

.control-toggle input[type="checkbox"]:checked+.toggle-slider::before {
    transform: translateX(20px);
    background-color: var(--bg-primary);
}

.toggle-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

/* Message Meta */
.message-meta {
    font-size: 0.6875rem;
    color: var(--text-tertiary);
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid var(--border-secondary);
}

/* Sources Display */
.sources-display {
    display: none;
    /* Hide from main message, show in slide-up */
    margin-top: 0.75rem;
    padding: 0.5rem;
    background-color: var(--bg-tertiary);
    border-left: 2px solid var(--accent-primary);
    border-radius: 4px;
    animation: sourcesMorphIn var(--transition-slow) cubic-bezier(0.4, 0, 0.2, 1);
    transition: all 0.3s ease;
}

.sources-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    padding: 0.25rem 0;
    margin-bottom: 0.5rem;
}

.sources-header strong {
    font-size: 0.75rem;
    color: var(--text-primary);
    font-weight: 600;
    letter-spacing: 0.01em;
}

.sources-collapse {
    font-size: 0.625rem;
    color: var(--text-tertiary);
    transition: transform 0.3s ease;
}

.sources-display.collapsed .sources-collapse {
    transform: rotate(-90deg);
}

.sources-content {
    display: block;
    transition: all 0.3s ease;
}

.sources-display.collapsed .sources-content {
    display: none;
}

.source-item {
    margin-bottom: 0.5rem;
    padding: 0.5rem 0.75rem;
    background-color: var(--bg-secondary);
    border-radius: 6px;
    transition: all var(--transition-fast);
    animation: sourceItemMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
}

.source-item:hover {
    background-color: var(--bg-elevated);
    transform: translateX(2px);
}

.source-item:last-child {
    margin-bottom: 0;
}

.source-link {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.source-link:hover {
    color: var(--accent-primary);
}

.source-type {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-weight: 400;
}

/* Agent Thinking Display */
.agent-thinking-display {
    margin-top: 0.75rem;
    padding: 1rem;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    animation: agentThinkingMorphIn var(--transition-slow) cubic-bezier(0.4, 0, 0.2, 1);
}

.agent-section {
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border-secondary);
}

.agent-section:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}

.agent-section strong {
    display: block;
    font-size: 0.8125rem;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    font-weight: 600;
    letter-spacing: 0.01em;
}

.agent-thinking-item {
    margin-left: 0.5rem;
    padding-left: 1rem;
}

/* Engines Display */
.engines-display {
    margin-top: 0.75rem;
    padding: 1rem;
    background-color: var(--bg-tertiary);
    border-left: 2px solid var(--accent-primary);
    border-radius: 8px;
    animation: thinkingMorphIn var(--transition-slow) cubic-bezier(0.4, 0, 0.2, 1);
}

.engines-display strong {
    display: block;
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.01em;
}

.engine-item {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    padding: 0.5rem;
    background-color: var(--bg-elevated);
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    animation: thinkingItemMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
}

.engine-item:last-child {
    margin-bottom: 0;
}

.engine-name {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.875rem;
}

.engine-algorithm {
    color: var(--text-secondary);
    font-size: 0.75rem;
    font-style: italic;
}

.engine-description {
    color: var(--text-tertiary);
    font-size: 0.75rem;
    margin-top: 0.25rem;
}

/* Algorithms Display */
.algorithms-display {
    margin-top: 0.75rem;
    padding: 1rem;
    background-color: var(--bg-tertiary);
    border-left: 2px solid var(--accent-secondary);
    border-radius: 8px;
    animation: thinkingMorphIn var(--transition-slow) cubic-bezier(0.4, 0, 0.2, 1);
}

.algorithms-display strong {
    display: block;
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.01em;
}

.algorithm-item {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    padding: 0.5rem;
    background-color: var(--bg-elevated);
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    animation: thinkingItemMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
}

.algorithm-item:last-child {
    margin-bottom: 0;
}

.algorithm-name {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.875rem;
}

.algorithm-method {
    color: var(--text-tertiary);
    font-size: 0.75rem;
    font-style: italic;
}

/* Animations */
@keyframes controlsMorphIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes sourcesMorphIn {
    from {
        opacity: 0;
        transform: translateX(-10px);
        clip-path: inset(0 100% 0 0);
    }

    to {
        opacity: 1;
        transform: translateX(0);
        clip-path: inset(0 0 0 0);
    }
}

@keyframes sourceItemMorphIn {
    from {
        opacity: 0;
        transform: translateX(-8px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes agentThinkingMorphIn {
    from {
        opacity: 0;
        transform: scale(0.98);
        filter: blur(2px);
    }

    to {
        opacity: 1;
        transform: scale(1);
        filter: blur(0);
    }
}

/* Sidebar */
.sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: 280px;
    height: 100vh;
    height: 100dvh;
    /* Dynamic viewport height for mobile Safari */
    max-height: 100vh;
    max-height: 100dvh;
    background-color: var(--bg-secondary);
    border-right: 1px solid var(--border-primary);
    transform: translateX(-100%);
    transition: transform var(--transition-base);
    z-index: 200;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    overflow-x: hidden;
    box-sizing: border-box;
    padding-bottom: calc(2rem + env(safe-area-inset-bottom, 0px));
    -webkit-overflow-scrolling: touch;
    /* Smooth scrolling on iOS */
}

.sidebar.open {
    transform: translateX(0);
}

/* Auto-retract sidebar on mobile */
@media (max-width: 768px) {
    .sidebar.open {
        transform: translateX(0);
    }

    /* Auto-retract when clicking outside */
    .main-wrapper::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        opacity: 0;
        pointer-events: none;
        transition: opacity var(--transition-base);
        z-index: 199;
    }

    .sidebar.open~.main-wrapper::after {
        opacity: 1;
        pointer-events: auto;
    }

    /* Overlay for mobile sidebar */
    .sidebar-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        opacity: 0;
        pointer-events: none;
        transition: opacity var(--transition-base);
        z-index: 199;
    }

    .sidebar.open~.main-wrapper .sidebar-overlay,
    .sidebar.open+.sidebar-overlay {
        opacity: 1;
        pointer-events: auto;
    }
}

.sidebar-header {
    padding: 1rem;
    border-bottom: 1px solid var(--border-primary);
}

.sidebar-search {
    position: relative;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border-primary);
}

.sidebar-search-input {
    width: 100%;
    padding: 0.625rem 2.5rem 0.625rem 0.875rem;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 0.875rem;
    font-family: inherit;
    outline: none;
    transition: all var(--transition-fast);
}

.sidebar-search-input:focus {
    border-color: var(--accent-primary);
    background-color: var(--bg-elevated);
    box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
}

.sidebar-search-input::placeholder {
    color: var(--text-tertiary);
}

.sidebar-search-clear {
    position: absolute;
    right: 1.25rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 4px;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
}

.sidebar-search-clear:hover {
    background-color: var(--bg-elevated);
    color: var(--text-primary);
}

.new-conversation-btn {
    width: 100%;
    padding: 0.75rem 1rem;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all var(--transition-base);
}

.new-conversation-btn:hover {
    background-color: var(--bg-elevated);
    border-color: var(--accent-primary);
}

.conversations-list {
    flex: 1;
    overflow-y: auto;
    padding: 0.5rem;
    padding-bottom: 1rem;
    /* Ensure bottom content isn't cut off on mobile */
}

.conversation-item {
    padding: 0.75rem 1rem;
    margin-bottom: 0.25rem;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all var(--transition-fast);
    position: relative;
}

.conversation-item:hover {
    background-color: var(--bg-tertiary);
}

.conversation-item.active {
    background-color: var(--bg-elevated);
    border: 1px solid var(--border-primary);
}

.conversation-title {
    font-size: 0.875rem;
    color: var(--text-secondary);
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.conversation-delete {
    opacity: 0;
    padding: 0.25rem 0.5rem;
    background: none;
    border: none;
    color: var(--text-tertiary);
    font-size: 1.25rem;
    line-height: 1;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.conversation-item:hover .conversation-delete {
    opacity: 1;
}

.conversation-item.no-results {
    justify-content: center;
    color: var(--text-tertiary);
    font-style: italic;
    cursor: default;
}

.conversation-item.no-results:hover {
    background-color: transparent;
}

.conversation-title mark {
    background-color: rgba(255, 255, 255, 0.2);
    color: var(--text-primary);
    padding: 0.125rem 0.25rem;
    border-radius: 3px;
}

.conversation-delete:hover {
    color: var(--text-primary);
    background-color: var(--bg-tertiary);
    border-radius: 4px;
}

/* App Container Layout */
.app-container {
    display: flex;
    min-height: 100vh;
}

/* Main Wrapper */
.main-wrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    transition: margin-left var(--transition-base);
}

.app-container:has(.sidebar.open) .main-wrapper {
    margin-left: 280px;
}

@media (max-width: 768px) {
    .app-container:has(.sidebar.open) .main-wrapper {
        margin-left: 0;
    }
}

/* Sidebar Toggle */
.sidebar-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    color: var(--text-primary);
    cursor: pointer;
    border-radius: 8px;
    transition: all var(--transition-fast);
    margin-right: 0.75rem;
}

.sidebar-toggle:hover {
    background-color: var(--bg-tertiary);
}

.sidebar-toggle .pulsing-ball-icon {
    width: 12px;
    height: 12px;
}

/* Message Actions */
.message-actions {
    position: relative;
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    opacity: 1;
    transition: opacity var(--transition-fast);
}

.action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 6px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.action-btn:hover {
    background-color: var(--bg-elevated);
    border-color: var(--accent-primary);
    color: var(--text-primary);
}

.action-btn.copied {
    background-color: var(--accent-primary);
    color: var(--bg-primary);
}

.message {
    position: relative;
}

/* Markdown Styles */
.message-content {
    word-wrap: break-word;
    white-space: pre-wrap;
}

.message-content h1,
.message-content h2,
.message-content h3,
.message-content h4,
.message-content h5,
.message-content h6 {
    margin-top: 0.75rem;
    /* Tighter top margin */
    margin-bottom: 0.375rem;
    /* Tighter bottom margin */
    font-weight: 600;
    line-height: 1.3;
    color: var(--text-primary);
}

.message-content h1:first-child,
.message-content h2:first-child,
.message-content h3:first-child,
.message-content h4:first-child,
.message-content h5:first-child,
.message-content h6:first-child {
    margin-top: 0;
    /* No top margin on first heading */
}

.message-content h1 {
    font-size: 1.375rem;
}

.message-content h2 {
    font-size: 1.125rem;
}

.message-content h3 {
    font-size: 1rem;
}

.message-content p {
    margin-bottom: 0.25rem;
    /* Tighter paragraph spacing for aesthetic stacking */
    line-height: 1.4;
    /* Tighter line height */
    color: var(--text-primary);
}

.message-content p:last-child {
    margin-bottom: 0;
    /* No margin on last paragraph */
}

.message-content ul,
.message-content ol {
    margin-left: 1.5rem;
    margin-bottom: 0.5rem;
    /* Tighter spacing */
    margin-top: 0.25rem;
    /* Tighter top margin */
    color: var(--text-primary);
}

.message-content ul:last-child,
.message-content ol:last-child {
    margin-bottom: 0;
    /* No margin on last list */
}

.message-content li {
    margin-bottom: 0.25rem;
    /* Tighter spacing between list items */
    line-height: 1.5;
    /* Tighter line height */
}

.message-content li:last-child {
    margin-bottom: 0;
    /* No margin on last list item */
}

.message-content code {
    background-color: var(--bg-tertiary);
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    font-size: 0.875em;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    color: var(--text-primary);
}

.message-content pre {
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    padding: 0.75rem;
    /* Tighter padding */
    overflow-x: auto;
    margin: 0.5rem 0;
    /* Tighter margins */
}

.message-content pre code {
    background: none;
    padding: 0;
    border-radius: 0;
    font-size: 0.875rem;
    line-height: 1.5;
    color: var(--text-primary);
}

.message-content blockquote {
    border-left: 3px solid var(--accent-primary);
    padding-left: 1rem;
    margin: 0.5rem 0;
    /* Tighter margins */
    color: var(--text-secondary);
    font-style: italic;
}

.message-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
}

.message-content table th,
.message-content table td {
    border: 1px solid var(--border-primary);
    padding: 0.5rem;
    text-align: left;
    color: var(--text-primary);
}

.message-content table th {
    background-color: var(--bg-tertiary);
    font-weight: 600;
}

.message-content a {
    color: var(--accent-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.message-content a:hover {
    border-bottom-color: var(--accent-primary);
}

/* Chart Container */
.chart-container {
    margin: 1.5rem 0;
    padding: 1rem;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    position: relative;
    overflow: hidden;
}

.chart-container canvas {
    max-width: 100%;
    height: auto;
}

/* Web Search Indicator */
.web-search-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 6px;
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-top: 0.5rem;
    animation: messageMorphIn var(--transition-base);
}

.web-search-indicator svg {
    flex-shrink: 0;
    color: var(--accent-primary);
}

/* Generated Images */
.generated-image {
    max-width: 100%;
    max-height: 500px;
    border-radius: 8px;
    margin: 1rem 0;
    border: 1px solid var(--border-primary);
    object-fit: contain;
    animation: messageMorphIn var(--transition-base);
}

/* Toast Notifications */
.toast-container {
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    pointer-events: none;
}

.toast {
    min-width: 250px;
    max-width: 400px;
    padding: 0.875rem 1rem;
    background-color: var(--bg-elevated);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 0.875rem;
    box-shadow: var(--shadow-lg);
    opacity: 0;
    transform: translateX(100%);
    transition: all var(--transition-base);
    pointer-events: auto;
}

.toast.show {
    opacity: 1;
    transform: translateX(0);
}

.toast-info {
    border-left: 3px solid var(--accent-primary);
}

.toast-success {
    border-left: 3px solid #4caf50;
    background-color: rgba(76, 175, 80, 0.1);
}

.toast-warning {
    border-left: 3px solid #ff9800;
    background-color: rgba(255, 152, 0, 0.1);
}

.toast-error {
    border-left: 3px solid #ff4444;
    background-color: rgba(255, 68, 68, 0.1);
}

@media (max-width: 480px) {
    .toast-container {
        bottom: 1rem;
        right: 1rem;
        left: 1rem;
    }

    .toast {
        min-width: auto;
        max-width: 100%;
    }
}

/* KaTeX Math Rendering */
.message-content .katex {
    font-size: 1.1em;
    color: var(--text-primary);
}

.message-content .katex-display {
    margin: 1rem 0;
    overflow-x: auto;
    overflow-y: hidden;
}

/* Settings Panel */
.settings-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-base);
}

.settings-overlay.active {
    opacity: 1;
    visibility: visible;
}

.settings-panel {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    max-width: 400px;
    background-color: var(--bg-primary);
    border-left: 1px solid var(--border-primary);
    z-index: 1001;
    transform: translateX(100%);
    transition: transform var(--transition-base);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    overflow-x: hidden;
    box-sizing: border-box;
    padding-bottom: 1rem;
}

.settings-panel.open {
    transform: translateX(0);
}

.settings-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.5rem 1.25rem;
    border-bottom: 1px solid var(--border-primary);
}

.settings-header h2 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.settings-close {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
}

.settings-close:hover {
    background-color: var(--bg-elevated);
    color: var(--text-primary);
}

.settings-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 1.25rem;
    padding-bottom: 2rem;
    box-sizing: border-box;
}

.settings-section {
    margin-bottom: 2rem;
}

.settings-section:last-child {
    margin-bottom: 0;
}

.settings-section h3 {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.settings-group {
    margin-bottom: 1.5rem;
}

.settings-group:last-child {
    margin-bottom: 0;
}

.settings-label {
    display: block;
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    font-weight: 500;
}

.settings-label:has(.settings-checkbox) {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all var(--transition-fast);
    margin-bottom: 0.5rem;
}

.settings-label:has(.settings-checkbox):hover {
    background-color: var(--bg-elevated);
}

.settings-checkbox {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: var(--accent-primary);
}

.shortcut-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background-color: var(--bg-secondary);
    border-radius: 6px;
    font-size: 0.875rem;
}

.shortcut-item:last-child {
    margin-bottom: 0;
}

.shortcut-key {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    background-color: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 4px;
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    color: var(--text-primary);
    font-weight: 500;
    min-width: 100px;
    text-align: center;
}

.shortcut-desc {
    color: var(--text-secondary);
    flex: 1;
    margin-left: 1rem;
}

.settings-select {
    width: 100%;
    padding: 0.75rem 1rem;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 0.9375rem;
    font-family: inherit;
    outline: none;
    transition: all var(--transition-fast);
    cursor: pointer;
}

.settings-select:hover {
    border-color: var(--border-secondary);
}

.settings-select:focus {
    border-color: var(--accent-primary);
}

.settings-range {
    width: 100%;
    height: 6px;
    background-color: var(--bg-secondary);
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
    appearance: none;
    cursor: pointer;
}

.settings-range::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    background-color: var(--accent-primary);
    border-radius: 50%;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.settings-range::-webkit-slider-thumb:hover {
    transform: scale(1.1);
}

.settings-range::-moz-range-thumb {
    width: 18px;
    height: 18px;
    background-color: var(--accent-primary);
    border-radius: 50%;
    cursor: pointer;
    border: none;
    transition: all var(--transition-fast);
}

.settings-range::-moz-range-thumb:hover {
    transform: scale(1.1);
}

.settings-value {
    display: inline-block;
    margin-left: 0.75rem;
    font-size: 0.875rem;
    color: var(--text-primary);
    font-weight: 500;
    min-width: 3rem;
    text-align: right;
}

.settings-button {
    width: 100%;
    padding: 0.875rem 1rem;
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 8px;
    color: var(--text-primary);
    font-size: 0.9375rem;
    font-family: inherit;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
    margin-bottom: 0.75rem;
}

.settings-button:last-child {
    margin-bottom: 0;
}

.settings-button:hover {
    background-color: var(--bg-elevated);
    border-color: var(--border-secondary);
}

.settings-button.danger {
    color: #ff4444;
    border-color: #ff4444;
}

.settings-button.danger:hover {
    background-color: rgba(255, 68, 68, 0.1);
}

/* Mobile Controls */
@media (max-width: 480px) {
    .controls-panel {
        padding: 0.875rem 1rem;
        gap: 0.625rem;
    }

    .control-group {
        min-width: 100px;
    }

    .control-select {
        font-size: 0.8125rem;
        padding: 0.5rem 0.75rem;
    }

    .sidebar {
        width: 85%;
        max-width: 320px;
    }

    .sidebar.open~.main-wrapper {
        margin-left: 0;
    }

    .message-actions {
        opacity: 1;
    }

    .settings-panel {
        max-width: 100%;
    }
}

/* Unified Status Carousel - Compact modular rectangle */
.status-carousel {
    display: block;
    margin: 0.125rem 0;
    padding: 0.25rem 0.375rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    position: relative;
    z-index: 5;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.625rem;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    min-height: 1.5rem;
    max-height: 3rem;
    overflow: hidden;
}

.status-carousel.expanded {
    max-height: none;
    overflow: visible;
    z-index: 10;
    position: relative;
    padding-bottom: 0.5rem;
}

@media (max-width: 768px) {
    .status-carousel {
        font-size: 0.625rem;
        /* Even smaller on mobile */
        padding: 0.25rem 0.375rem;
        margin-top: 0.25rem;
    }
}

.status-carousel:hover {
    background: rgba(255, 255, 255, 0.05);
    /* Subtle hover */
    box-shadow: 0 2px 6px rgba(255, 255, 255, 0.05);
    /* Subtle shadow */
}

.status-carousel.expanded .status-carousel-content {
    display: none;
}

.status-carousel.expanded .status-carousel-expanded {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

.status-carousel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 0;
    padding: 0;
    border-bottom: none;
    cursor: pointer;
    transition: all 0.3s ease;
    height: 1rem;
    line-height: 1rem;
}

.status-carousel-header:hover {
    opacity: 0.8;
}

.status-collapse {
    font-size: 0.625rem;
    color: var(--text-tertiary);
    transition: transform 0.3s ease;
    margin-left: 0.5rem;
}

.status-carousel.expanded .status-collapse {
    transform: rotate(180deg);
}

.status-title {
    font-size: 0.6875rem;
    /* Smaller font */
    color: var(--text-primary);
    font-weight: 500;
    /* Lighter weight */
    letter-spacing: 0.01em;
}

@media (max-width: 768px) {
    .status-title {
        font-size: 0.625rem;
        /* Even smaller on mobile */
    }
}

.status-indicator {
    color: var(--accent-primary);
    font-size: 0.625rem;
    /* Smaller indicator */
    animation: statusPulse 2s ease-in-out infinite;
}

.status-indicator.loading {
    animation: statusPulse 1.5s ease-in-out infinite, statusFlash 3s ease-in-out infinite;
}

.status-indicator.thinking {
    animation: statusPulse 1.2s ease-in-out infinite, statusFlash 2.5s ease-in-out infinite;
}

.status-carousel-content {
    min-height: 1.25rem;
    max-height: 2rem;
    position: relative;
    overflow: hidden;
    margin-top: 0.125rem;
    padding: 0;
}

.status-carousel-expanded {
    display: none;
    max-height: 500px;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 0.5rem 0.375rem;
    margin-top: 0.25rem;
    background: rgba(255, 255, 255, 0.02);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    z-index: 10;
    box-sizing: border-box;
    width: 100%;
}

.status-item {
    padding: 0.25rem 0;
    margin: 0.25rem 0;
    background-color: transparent;
    border-radius: 0;
    animation: statusItemMorphIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transition: opacity 0.3s ease, transform 0.3s ease;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    opacity: 0;
    transform: translateY(4px);
    box-sizing: border-box;
}

.status-item.active {
    opacity: 1;
    transform: translateY(0);
    position: relative;
}

/* Status items in expanded view should always be visible */
.status-carousel-expanded .status-item {
    position: relative;
    opacity: 1;
    transform: translateY(0);
    margin: 0.5rem 0;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.status-carousel-expanded .status-item:last-child {
    border-bottom: none;
}

.status-item.loading {
    animation: statusItemMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1), statusItemPulse 2s ease-in-out infinite;
}

.status-item.thinking {
    animation: statusItemMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1), statusItemPulse 1.8s ease-in-out infinite;
}

/* Hide thinking items when complete (chunks have started) */
.status-item.thinking.complete {
    animation: none;
    opacity: 0.3 !important;
    pointer-events: none;
    transition: opacity 0.3s ease-out;
}

.status-item.thinking.complete[style*="opacity: 0"] {
    opacity: 0 !important;
    display: none !important;
}

.status-item-content.loading,
.status-item-content.thinking {
    animation: contentFlash 3s ease-in-out infinite;
}

/* Transition states for status carousel */
.status-carousel[data-stage="linguistics"] .status-item-action {
    display: none;
}

.status-carousel[data-stage="thinking"] .status-item-action {
    display: none;
}

.status-carousel[data-stage="actions"] .status-item-thinking {
    display: none;
}

.status-item:last-child {
    margin-bottom: 0;
}

.status-item-header {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    margin: 0;
    padding: 0;
    min-height: 1rem;
    line-height: 1rem;
    height: 1rem;
}

.status-item-icon {
    font-size: 0.75rem;
    width: 0.875rem;
    text-align: center;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.status-item-title {
    flex: 0 0 auto;
    font-size: 0.6875rem;
    color: var(--text-primary);
    font-weight: 500;
    line-height: 1.25rem;
    margin: 0;
    padding: 0;
}

@media (max-width: 768px) {
    .status-item-title {
        font-size: 0.625rem;
        /* Even smaller on mobile */
    }
}

.status-item-status {
    font-size: 0.625rem;
    color: var(--text-tertiary);
    margin-left: auto;
    flex-shrink: 0;
    line-height: 1.25rem;
}

.status-item-content {
    font-size: 0.625rem;
    color: var(--text-secondary);
    line-height: 1.2;
    margin: 0;
    padding: 0;
    width: 100%;
    max-height: 1.5rem;
    overflow: hidden;
    text-overflow: ellipsis;
    display: flex;
    flex-wrap: nowrap;
    gap: 0.25rem;
    align-items: center;
    white-space: nowrap;
    max-width: 100%;
}

@media (max-width: 768px) {
    .status-item-content {
        font-size: 0.625rem;
        /* Even smaller on mobile */
    }
}

.thinking-bullets {
    display: flex;
    flex-direction: column;
    gap: 0;
    margin: 0;
    padding: 0;
}

.thinking-bullet {
    font-size: 0.625rem;
    color: var(--text-tertiary);
    line-height: 1.2;
    padding-left: 0;
    margin: 0;
    padding-top: 0;
    padding-bottom: 0;
    opacity: 0;
    transform: translateX(-10px);
    animation: thinkingBulletIn 0.3s ease forwards;
    display: block;
    text-indent: 0;
}

@media (max-width: 768px) {
    .thinking-bullet {
        font-size: 0.5625rem;
        /* Even smaller on mobile */
    }
}

.thinking-bullet.live-streaming {
    animation: thinkingBulletIn 0.3s ease forwards, thinkingPulse 1.8s ease-in-out infinite, thinkingFlash 2.5s ease-in-out infinite;
}

.thinking-bullet.loading {
    animation: thinkingBulletIn 0.3s ease forwards, thinkingPulse 1.5s ease-in-out infinite, thinkingFlash 3s ease-in-out infinite;
}

@keyframes thinkingBulletIn {
    from {
        opacity: 0;
        transform: translateX(-10px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes thinkingPulse {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.7;
    }
}

@keyframes thinkingFlash {

    0%,
    100% {
        opacity: 1;
        text-shadow: 0 0 0 rgba(255, 255, 255, 0);
    }

    25% {
        opacity: 0.9;
        text-shadow: 0 0 3px rgba(255, 255, 255, 0.3);
    }

    50% {
        opacity: 1;
        text-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
    }

    75% {
        opacity: 0.9;
        text-shadow: 0 0 3px rgba(255, 255, 255, 0.3);
    }
}


@keyframes statusCarouselMorphIn {
    from {
        opacity: 0;
        transform: translateY(-10px) scale(0.98);
        filter: blur(4px);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
    }
}

@keyframes statusItemMorphIn {
    from {
        opacity: 0;
        transform: translateX(-10px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* Action Tracking (ICEBURG thinking display) - SECOND (after word breakdown) */
.action-tracking {
    margin-top: 0.75rem;
    padding: 1rem;
    background-color: var(--bg-tertiary);
    border-left: 3px solid var(--accent-primary);
    border-radius: 8px;
    animation: actionTrackingMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    z-index: 5;
    /* Show after word breakdown */
}

.bullet-item {
    opacity: 0;
    transform: translateX(-10px);
    transition: opacity 0.3s ease, transform 0.3s ease;
}

.bullet-content {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.bullet {
    color: var(--accent-primary);
    font-size: 1.25rem;
    font-weight: bold;
    animation: bulletPulse 1s ease-in-out infinite;
}

.bullet-text {
    flex: 1;
    font-size: 0.875rem;
    color: var(--text-primary);
}

.bullet-status {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    text-transform: uppercase;
    padding: 0.25rem 0.5rem;
    background-color: var(--bg-secondary);
    border-radius: 4px;
}

.action-tracking strong {
    display: block;
    font-size: 0.8125rem;
    color: var(--text-primary);
    margin-bottom: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.01em;
}

.action-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background-color: var(--bg-secondary);
    border-radius: 6px;
    cursor: pointer;
    transition: all var(--transition-fast);
    animation: actionItemMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.action-item:hover {
    background-color: var(--bg-elevated);
    transform: translateX(2px);
}

.action-item:last-child {
    margin-bottom: 0;
}

.action-item.processing {
    border-left: 3px solid var(--accent-secondary);
}

.action-item.complete {
    border-left: 3px solid #00ff00;
    opacity: 0.8;
}

.action-item.error {
    border-left: 3px solid #ff4444;
}

.action-icon {
    font-size: 1.25rem;
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: iconPulse 2s ease-in-out infinite;
}

.action-item.processing .action-icon {
    animation: iconPulse 1s ease-in-out infinite;
}

.action-item.complete .action-icon {
    animation: none;
}

.action-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.action-title {
    font-size: 0.875rem;
    color: var(--text-primary);
    font-weight: 500;
    line-height: 1.4;
}

.action-status {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 500;
}

.action-item.processing .action-status {
    color: var(--accent-secondary);
    animation: statusPulse 1.5s ease-in-out infinite;
}

.action-item.complete .action-status {
    color: #00ff00;
}

.action-item.error .action-status {
    color: #ff4444;
}

.action-details {
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid var(--border-secondary);
    font-size: 0.8125rem;
    color: var(--text-secondary);
    line-height: 1.6;
}

.action-details>div {
    margin-bottom: 0.5rem;
}

.action-details>div:last-child {
    margin-bottom: 0;
}

.action-item.expanded .action-details {
    display: block;
}

/* Enhanced Thinking Display (ICEBURG style) - THIRD (after actions) */
/* HIDDEN - Thinking is now in status carousel only */
.thinking-display {
    display: none !important;
    /* Hide duplicate thinking display */
    margin-top: 0.75rem;
    padding: 1rem;
    background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
    border-left: 3px solid var(--accent-primary);
    border-radius: 8px;
    animation: thinkingMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    z-index: 1;
    /* Show last */
}

.thinking-item.live-writing {
    position: relative;
}

.thinking-item.live-writing::after {
    content: '|';
    color: var(--accent-primary);
    animation: cursorBlink 1s ease-in-out infinite;
    margin-left: 2px;
}

.thinking-display::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--accent-primary), transparent);
    animation: thinkingShimmer 2s ease-in-out infinite;
}

/* Removed duplicate .thinking-display strong - using the one at line 453 */

/* Removed duplicate .thinking-item definition - using the one at line 457 */

.thinking-item:last-child {
    margin-bottom: 0;
}

/* Loading Animation (ICEBURG style) */
.message.loading {
    position: relative;
}

.message.loading::after {
    content: '';
    position: absolute;
    bottom: 1rem;
    left: 1rem;
    width: 8px;
    height: 8px;
    background-color: var(--accent-primary);
    border-radius: 50%;
    animation: loadingPulse 1.5s ease-in-out infinite;
}

.message.loading .message-content {
    color: var(--text-secondary);
    font-style: italic;
}

/* Smooth Content Transitions */
.message-content {
    transition: all var(--transition-base);
}

/* GPT-5-style instant streaming - no visible delay */
.message-content.streaming-instant {
    /* Instant rendering - no animation delay */
    opacity: 1;
    transition: none;
    /* No transition for instant feel */
}

/* Smooth character appearance (subtle, instant) */
@keyframes characterAppear {
    0% {
        opacity: 0.8;
    }

    100% {
        opacity: 1;
    }
}

.message-content.streaming-instant .visible-text-content {
    animation: characterAppear 0.05s ease-out;
    /* Very fast, subtle */
}

/* Animations */
@keyframes actionTrackingMorphIn {
    from {
        opacity: 0;
        transform: translateY(-10px) scale(0.98);
        filter: blur(4px);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
    }
}

@keyframes actionItemMorphIn {
    from {
        opacity: 0;
        transform: translateX(-10px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes iconPulse {

    0%,
    100% {
        transform: scale(1);
        opacity: 1;
    }

    50% {
        transform: scale(1.1);
        opacity: 0.8;
    }
}

@keyframes statusPulse {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.6;
    }
}

@keyframes statusFlash {

    0%,
    100% {
        opacity: 1;
        text-shadow: 0 0 0 rgba(255, 255, 255, 0);
    }

    25% {
        opacity: 0.9;
        text-shadow: 0 0 4px rgba(255, 255, 255, 0.4);
    }

    50% {
        opacity: 1;
        text-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
    }

    75% {
        opacity: 0.9;
        text-shadow: 0 0 4px rgba(255, 255, 255, 0.4);
    }
}

@keyframes statusItemPulse {

    0%,
    100% {
        opacity: 1;
        transform: scale(1);
    }

    50% {
        opacity: 0.95;
        transform: scale(0.98);
    }
}

@keyframes contentFlash {

    0%,
    100% {
        opacity: 1;
        filter: brightness(1);
    }

    25% {
        opacity: 0.95;
        filter: brightness(1.1);
    }

    50% {
        opacity: 1;
        filter: brightness(1.2);
    }

    75% {
        opacity: 0.95;
        filter: brightness(1.1);
    }
}

@keyframes thinkingShimmer {
    0% {
        transform: translateX(-100%);
    }

    100% {
        transform: translateX(100%);
    }
}

@keyframes thinkingDotPulse {

    0%,
    100% {
        opacity: 1;
        transform: scale(1);
    }

    50% {
        opacity: 0.5;
        transform: scale(1.2);
    }
}

@keyframes loadingPulse {

    0%,
    100% {
        opacity: 1;
        transform: scale(1);
    }

    50% {
        opacity: 0.3;
        transform: scale(1.5);
    }
}

@keyframes contentStream {
    from {
        opacity: 0.5;
        transform: translateY(2px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Word Breakdown Display - FIRST (cycling animation) - More compact */
.word-breakdown-display {
    display: block !important;
    /* Show during processing so user can see linguistic analysis */
    visibility: visible !important;
    opacity: 1 !important;
    margin-top: 0.5rem;
    padding: 0.5rem;
    background: transparent !important;
    /* No grey background */
    border: none !important;
    /* No border */
    border-radius: 0;
    /* Remove animation that starts with opacity 0 - it conflicts with visibility */
    position: relative;
    z-index: 10;
    /* Show first */
    font-size: 0.6875rem;
    /* Smaller font */
    box-shadow: none;
    /* No glow */
}

@media (max-width: 768px) {
    .word-breakdown-display {
        font-size: 0.625rem;
        /* Even smaller on mobile */
        padding: 0.375rem;
        margin-top: 0.375rem;
    }
}

.word-breakdown-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    padding: 0.25rem 0;
    margin-bottom: 0.5rem;
}

.word-breakdown-header strong {
    font-size: 0.75rem;
    color: var(--text-primary);
    font-weight: 600;
    letter-spacing: 0.01em;
}

.word-breakdown-collapse {
    font-size: 0.625rem;
    color: var(--text-tertiary);
    transition: transform 0.3s ease;
}

.word-breakdown-display.collapsed .word-breakdown-collapse {
    transform: rotate(-90deg);
}

.word-breakdown-content {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    transition: all 0.3s ease;
}

.word-breakdown-display.collapsed .word-breakdown-content {
    display: none !important;
}

/* Algorithm Step Visualization - Cycling animation - More compact */
.algorithm-step {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.375rem 0.5rem;
    margin-bottom: 0.25rem;
    background-color: var(--bg-secondary);
    border-radius: 4px;
    animation: algorithmStepMorphIn var(--transition-base) cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 0.75rem;
}

.algorithm-step.cycling {
    opacity: 1;
    transform: translateX(0);
    transition: opacity 0.3s ease, transform 0.3s ease;
}

.algorithm-step:last-child {
    margin-bottom: 0;
}

.step-name {
    font-size: 0.875rem;
    color: var(--text-primary);
    font-weight: 500;
    flex: 1;
    text-transform: capitalize;
}

.step-status {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    text-transform: uppercase;
    font-weight: 500;
}

.step-status.processing {
    background-color: var(--bg-elevated);
    color: var(--accent-secondary);
    animation: statusPulse 1.5s ease-in-out infinite;
}

.step-status.complete {
    background-color: rgba(0, 255, 0, 0.1);
    color: #00ff00;
}

.step-status.error {
    background-color: rgba(255, 68, 68, 0.1);
    color: #ff4444;
}

.step-time {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-family: monospace;
}

/* Flowing Text Display - Normal sentence flow */
.word-flowing-text {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    line-height: 1.6;
    /* Normal sentence spacing */
    font-size: 0.75rem;
    /* Smaller font for mobile */
    color: var(--text-primary);
    word-wrap: break-word;
    white-space: normal;
    text-indent: 0;
    margin-bottom: 0.25rem;
}

@media (max-width: 768px) {
    .word-flowing-text {
        font-size: 0.6875rem;
        /* Even smaller on mobile */
        line-height: 1.5;
    }
}

/* Neon Cyberpunk Word Container - Normal sentence flow */
.word-neon-container {
    display: inline;
    position: relative;
    margin-right: 0.125rem;
    /* Tighter spacing */
    vertical-align: baseline;
    /* Normal text baseline */
    line-height: 1.6;
    /* Normal sentence line height */
}

.word-inline-neon {
    display: inline-block;
    position: relative;
    transition: all 0.2s ease;
}

/* Neon Cyberpunk Word Parts - No Background, Normal Spacing */
.word-part-neon {
    display: inline;
    position: relative;
    padding: 0;
    margin: 0;
    font-weight: 500;
    /* Lighter weight for normal text */
    font-size: inherit;
    /* Inherit from parent */
    transition: all 0.15s ease;
    text-shadow: none;
    background: transparent !important;
}

/* Morphological Colors - Neon Cyberpunk */
.word-part-neon.prefix {
    color: #00ffff;
    /* Cyan neon */
    text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff, 0 0 15px #00ffff;
}

.word-part-neon.root {
    color: #ffffff;
    /* White text, no purple glow */
    text-shadow: none;
    /* No glow */
}

.word-part-neon.suffix {
    color: #ffff00;
    /* Yellow neon */
    text-shadow: 0 0 5px #ffff00, 0 0 10px #ffff00, 0 0 15px #ffff00;
}

/* Etymology Origin Colors - Neon Cyberpunk */
.word-part-neon.origin-latin {
    color: #00ff00;
    /* Green neon */
    text-shadow: 0 0 5px #00ff00, 0 0 10px #00ff00, 0 0 15px #00ff00;
}

.word-part-neon.origin-greek {
    color: #ffffff;
    /* White text, no pink/purple glow */
    text-shadow: none;
    /* No glow */
}

.word-part-neon.origin-germanic,
.word-part-neon.origin-german {
    color: #00ffff;
    /* Cyan neon */
    text-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff, 0 0 15px #00ffff;
}

.word-part-neon.origin-french {
    color: #ff8000;
    /* Orange neon */
    text-shadow: 0 0 5px #ff8000, 0 0 10px #ff8000, 0 0 15px #ff8000;
}

.word-part-neon.origin-english {
    color: #ffffff;
    /* White neon */
    text-shadow: 0 0 5px #ffffff, 0 0 10px #ffffff, 0 0 15px #ffffff;
}

.word-part-neon.origin-unknown {
    color: #808080;
    /* Gray neon */
    text-shadow: 0 0 5px #808080, 0 0 10px #808080, 0 0 15px #808080;
}

/* Don't show "unknown" tag - use morphological colors instead */
.word-part-neon:not(.origin-latin):not(.origin-greek):not(.origin-germanic):not(.origin-german):not(.origin-french):not(.origin-english) {
    /* Keep morphological colors if no etymology detected */
}

/* Neon Lit Animation - Fast Machine Pattern Matching */
.word-part-neon.neon-lit {
    animation: neonFlash 0.15s ease-in-out;
}

@keyframes neonFlash {

    0%,
    100% {
        filter: brightness(1);
        text-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 15px currentColor;
    }

    50% {
        filter: brightness(2);
        text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor, 0 0 40px currentColor;
    }
}

/* Linguistic Origins - Below entire sentence, smaller text */
.word-linguistic-origins {
    display: none;
    font-size: 0.5rem;
    color: #666666;
    line-height: 1.3;
    margin-top: 0.25rem;
    margin-left: 0;
    font-family: 'Courier New', monospace;
    opacity: 0.7;
    text-transform: lowercase;
    letter-spacing: 0.02em;
    transition: all 0.3s ease;
    padding-top: 0.25rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

@media (max-width: 768px) {
    .word-linguistic-origins {
        font-size: 0.4375rem;
        /* Even smaller on mobile */
        margin-top: 0.1875rem;
        padding-top: 0.1875rem;
    }
}

/* Pulsing glow for active words */
.word-part-neon.origin-latin,
.word-part-neon.origin-greek,
.word-part-neon.origin-germanic,
.word-part-neon.origin-german,
.word-part-neon.origin-french,
.word-part-neon.origin-english {
    animation: neonPulse 2s ease-in-out infinite;
}

/* Slow flash effect that fades over words */
@keyframes wordSlowFlash {

    0%,
    100% {
        opacity: 1;
        filter: brightness(1);
        text-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 15px currentColor;
    }

    25% {
        opacity: 0.9;
        filter: brightness(1.1);
        text-shadow: 0 0 8px currentColor, 0 0 15px currentColor, 0 0 20px currentColor;
    }

    50% {
        opacity: 1;
        filter: brightness(1.2);
        text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 25px currentColor;
    }

    75% {
        opacity: 0.9;
        filter: brightness(1.1);
        text-shadow: 0 0 8px currentColor, 0 0 15px currentColor, 0 0 20px currentColor;
    }
}

.word-part-neon.slow-flash {
    animation: wordSlowFlash 3s ease-in-out infinite;
}

@keyframes neonPulse {

    0%,
    100% {
        filter: brightness(1);
        text-shadow: 0 0 5px currentColor, 0 0 10px currentColor, 0 0 15px currentColor;
    }

    50% {
        filter: brightness(1.3);
        text-shadow: 0 0 8px currentColor, 0 0 15px currentColor, 0 0 20px currentColor;
    }
}

.word-title {
    font-size: 1rem;
    color: var(--text-primary);
    font-weight: 600;
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border-secondary);
}

.word-analysis {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.morphological,
.etymology,
.compression-hints {
    font-size: 0.8125rem;
    color: var(--text-secondary);
}

.morphological strong,
.etymology strong,
.compression-hints strong {
    display: block;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.compression-hints ul {
    margin: 0.5rem 0 0 1rem;
    padding: 0;
    list-style: disc;
}

.compression-hints li {
    margin-bottom: 0.25rem;
    color: var(--text-tertiary);
}

/* Animations */
@keyframes wordBreakdownMorphIn {
    from {
        opacity: 0;
        transform: translateY(-10px) scale(0.98);
        filter: blur(4px);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
    }
}

@keyframes algorithmStepMorphIn {
    from {
        opacity: 0;
        transform: translateX(-10px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes wordCardMorphIn {
    from {
        opacity: 0;
        transform: scale(0.98);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes bulletPulse {

    0%,
    100% {
        opacity: 1;
        transform: scale(1);
    }

    50% {
        opacity: 0.6;
        transform: scale(1.1);
    }
}

@keyframes cursorBlink {

    0%,
    50% {
        opacity: 1;
    }

    51%,
    100% {
        opacity: 0;
    }
}

/* Export Buttons - Small inline buttons at bottom */
.export-buttons-inline {
    display: flex;
    gap: 0.375rem;
    align-items: center;
    justify-content: flex-end;
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid var(--border-secondary);
    position: relative;
    z-index: 50;
    /* Lower than thoughts trigger */
}

.export-btn-small {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    padding: 0;
    background-color: var(--bg-elevated);
    border: 1px solid var(--border-primary);
    border-radius: 4px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s ease;
}

.export-btn-small:hover {
    background-color: var(--accent-primary);
    color: var(--bg-primary);
    border-color: var(--accent-primary);
    transform: scale(1.1);
}

.export-btn-small svg {
    width: 14px;
    height: 14px;
}

.export-display {
    margin-top: 1rem;
    padding: 1rem;
    background-color: var(--bg-elevated);
    border-radius: 8px;
    border: 1px solid var(--border-primary);
}

.export-display canvas {
    max-width: 100%;
    height: auto;
}

@keyframes exportOptionsMorphIn {
    from {
        opacity: 0;
        transform: translateY(-10px) scale(0.98);
        filter: blur(4px);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
    }
}

/* Advanced Visualization Panels - Hidden by default, only show when Dashboard button clicked */
.visualization-panels {
    margin: 20px;
    display: none !important;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.95);
    z-index: 1000;
    overflow-y: auto;
    padding: 20px;
}

.visualization-panels.show {
    display: block !important;
}

.viz-panel {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    margin-bottom: 20px;
    overflow: hidden;
}

.panel-header {
    background: var(--bg-tertiary);
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-secondary);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.panel-header h3 {
    margin: 0;
    color: var(--text-primary);
    font-size: 1.2rem;
    font-weight: 600;
}

.panel-controls {
    display: flex;
    gap: 8px;
}

.panel-toggle {
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    color: var(--text-primary);
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all var(--transition-fast);
}

.panel-toggle:hover {
    background: var(--bg-elevated);
    border-color: var(--accent-primary);
}

.panel-toggle.active {
    background: var(--accent-primary);
    color: var(--bg-primary);
}

.panel-content {
    padding: 20px;
}

.viz-section {
    margin-bottom: 30px;
}

.viz-section h4 {
    color: var(--text-primary);
    margin-bottom: 16px;
    font-size: 1.1rem;
    font-weight: 500;
}

/* Molecular Viewer */
.molecular-canvas {
    width: 100%;
    height: 400px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: 8px;
    margin-bottom: 16px;
}

.molecular-controls {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 12px;
    margin-bottom: 16px;
}

.molecular-results {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: 8px;
    padding: 16px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    max-height: 300px;
    overflow-y: auto;
}

/* Chart Grid */
.chart-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.chart-container {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: 8px;
    padding: 16px;
    height: 300px;
}

/* Physiological Monitor */
.monitor-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.monitor-item {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: 8px;
    padding: 16px;
    text-align: center;
}

.monitor-label {
    display: block;
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 8px;
}

.monitor-value {
    display: block;
    color: var(--accent-primary);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.monitor-bar {
    width: 100%;
    height: 8px;
    background: var(--bg-primary);
    border-radius: 4px;
    overflow: hidden;
}

.monitor-fill {
    height: 100%;
    background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);
    border-radius: 4px;
    transition: width var(--transition-base);
}

/* Prediction Lab */
.prediction-section {
    margin-bottom: 30px;
}

.prediction-inputs {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.input-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}

.input-row label {
    min-width: 120px;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.input-row input,
.input-row select {
    flex: 1;
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    color: var(--text-primary);
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.9rem;
}

.input-row input:focus,
.input-row select:focus {
    outline: none;
    border-color: var(--accent-primary);
}

.prediction-results {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: 8px;
    padding: 20px;
}

.prediction-summary {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--border-secondary);
}

.prediction-direction {
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent-primary);
}

.prediction-confidence {
    font-size: 1.2rem;
    color: var(--text-secondary);
}

.prediction-factors {
    margin-bottom: 20px;
}

.prediction-timeline {
    background: var(--bg-secondary);
    border-radius: 6px;
    padding: 16px;
    min-height: 100px;
}

/* Hypothesis Testing */
.hypothesis-inputs {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
}

.hypothesis-inputs textarea {
    width: 100%;
    min-height: 100px;
    background: var(--bg-primary);
    border: 1px solid var(--border-primary);
    color: var(--text-primary);
    padding: 12px;
    border-radius: 6px;
    font-family: inherit;
    font-size: 0.9rem;
    resize: vertical;
}

.hypothesis-inputs textarea:focus {
    outline: none;
    border-color: var(--accent-primary);
}

.hypothesis-controls {
    display: flex;
    gap: 12px;
    margin-top: 12px;
}

.hypothesis-results {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-secondary);
    border-radius: 8px;
    padding: 20px;
}

.hypothesis-tree {
    background: var(--bg-secondary);
    border-radius: 6px;
    padding: 16px;
    margin-bottom: 16px;
    min-height: 200px;
}

.evidence-display {
    background: var(--bg-secondary);
    border-radius: 6px;
    padding: 16px;
    min-height: 150px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .visualization-panels {
        margin: 10px;
    }

    .panel-header {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
    }

    .panel-controls {
        width: 100%;
        justify-content: flex-start;
        flex-wrap: wrap;
    }

    .chart-grid {
        grid-template-columns: 1fr;
    }

    .monitor-grid {
        grid-template-columns: 1fr;
    }

    .hypothesis-controls {
        flex-direction: column;
    }

    .molecular-controls {
        grid-template-columns: 1fr;
    }
}

/* ============================================
   THINKING BLACKBOARD VISUALIZATION
   Shows paths, points, projections, insights
   ============================================ */

.thinking-blackboard {
    margin: 1rem 0;
    padding: 1rem;
    background: linear-gradient(135deg, rgba(0, 255, 255, 0.05) 0%, rgba(255, 0, 255, 0.05) 100%);
    border: 1px solid rgba(0, 255, 255, 0.2);
    border-radius: 8px;
    animation: blackboardMorphIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes blackboardMorphIn {
    0% {
        opacity: 0;
        transform: translateY(10px) scale(0.98);
    }

    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.blackboard-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid rgba(0, 255, 255, 0.2);
}

.blackboard-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
}

.blackboard-indicator {
    color: #00ffff;
    animation: pulse 2s ease-in-out infinite;
    font-size: 0.75rem;
}

@keyframes pulse {

    0%,
    100% {
        opacity: 1;
    }

    50% {
        opacity: 0.5;
    }
}

.blackboard-content {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.blackboard-paths {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.thinking-point {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    background: rgba(0, 255, 255, 0.05);
    border-left: 2px solid #00ffff;
    border-radius: 4px;
    opacity: 0;
    transform: translateX(-10px);
    transition: all 0.3s ease;
    animation: thinkingPointIn 0.3s ease forwards;
}

@keyframes thinkingPointIn {
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.thinking-dot {
    color: #00ffff;
    font-size: 0.75rem;
    animation: dotPulse 1.5s ease-in-out infinite;
}

@keyframes dotPulse {

    0%,
    100% {
        opacity: 1;
        transform: scale(1);
    }

    50% {
        opacity: 0.7;
        transform: scale(1.2);
    }
}

.thinking-text {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    line-height: 1.4;
}

.blackboard-insights {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.insight-badge {
    padding: 0.25rem 0.5rem;
    background: rgba(0, 255, 0, 0.1);
    border: 1px solid rgba(0, 255, 0, 0.3);
    border-radius: 4px;
    font-size: 0.75rem;
    color: #00ff00;
}

.blackboard-sources {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-top: 0.5rem;
    font-size: 0.75rem;
    color: var(--text-tertiary);
}

.source-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.25rem 0;
}

.source-item::before {
    content: '🌐';
    font-size: 0.875rem;
}

/* Answer container appears below blackboard */
.answer-container {
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    animation: answerAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Ensure visible text content preserves spaces and word boundaries */
.visible-text-content {
    white-space: pre-wrap;
    word-spacing: normal;
}

@keyframes answerAppear {
    0% {
        opacity: 0;
        transform: translateY(10px);
    }

    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ICEBURG Real-Time Thinking Stream - Compact Single Line with Dropdown */
.thoughts-stream-container {
    position: relative;
    margin: 0 0 0.25rem 0;
    /* Minimal spacing - almost none */
    padding: 0.4rem 0.6rem;
    /* Small, compact padding */
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 6px;
    font-size: 0.7rem;
    /* Small, modular text */
    line-height: 1.2;
    /* Tight line height - almost no spacing */
    z-index: 1;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    min-height: 1.5rem;
    /* Ensure it has height */
}

.thoughts-stream-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    margin: 0;
    padding: 0;
    border: none;
}

.thoughts-stream-current {
    flex: 1;
    font-size: 0.7rem;
    /* Small, modular */
    color: var(--text-secondary);
    opacity: 0.7;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
    /* Tight - almost no spacing */
    margin: 0;
    padding: 0;
    position: relative;
}

.thoughts-stream-current.glitch-active {
    animation: glitchText 0.3s ease-in-out infinite;
}

/* Glitch animation effect - runs through text while loading */
@keyframes glitchText {
    0% {
        transform: translate(0);
        text-shadow: 0 0 rgba(255, 255, 255, 0.1);
        filter: hue-rotate(0deg);
    }

    10% {
        transform: translate(-0.5px, 0.5px);
        text-shadow: -0.5px 0.5px rgba(255, 0, 255, 0.3);
        filter: hue-rotate(90deg);
    }

    20% {
        transform: translate(0.5px, -0.5px);
        text-shadow: 0.5px -0.5px rgba(0, 255, 255, 0.3);
        filter: hue-rotate(180deg);
    }

    30% {
        transform: translate(-0.5px, -0.5px);
        text-shadow: -0.5px -0.5px rgba(255, 255, 0, 0.3);
        filter: hue-rotate(270deg);
    }

    40% {
        transform: translate(0.5px, 0.5px);
        text-shadow: 0.5px 0.5px rgba(255, 0, 0, 0.3);
        filter: hue-rotate(360deg);
    }

    50%,
    100% {
        transform: translate(0);
        text-shadow: 0 0 rgba(255, 255, 255, 0.1);
        filter: hue-rotate(0deg);
    }
}

.thoughts-stream-toggle {
    background: none;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
    padding: 0.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
    opacity: 0.5;
    flex-shrink: 0;
}

.thoughts-stream-toggle:hover {
    opacity: 0.8;
}

.thoughts-stream-toggle svg {
    width: 10px;
    height: 6px;
}

.thoughts-stream-items {
    display: none;
    /* Hidden by default - shown when dropdown clicked */
    flex-direction: column;
    gap: 0.1rem;
    /* Minimal spacing between items - almost none */
    margin-top: 0.3rem;
    padding-top: 0.3rem;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    max-height: 200px;
    overflow-y: auto;
}

.thoughts-stream-item {
    font-size: 0.65rem;
    /* Even smaller in dropdown */
    color: var(--text-tertiary);
    opacity: 0.6;
    padding: 0.15rem 0;
    /* Minimal padding - almost no spacing */
    margin: 0;
    line-height: 1.2;
    /* Tight - almost no spacing */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    transition: opacity 0.2s ease;
}

.thoughts-stream-item.active {
    opacity: 0.8;
    color: var(--text-secondary);
}

.thoughts-stream-item.complete {
    opacity: 0.5;
}

/* Interactive Workflow System Styles */
.workflow-container {
    margin: 20px 0;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.interactive-step-card {
    background: linear-gradient(135deg, #1e1e1e 0%, #2a2a2a 100%);
    border: 1px solid #333;
    border-radius: 12px;
    padding: 20px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.interactive-step-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #4a9eff, #7b68ee);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease;
}

.interactive-step-card.active::before {
    transform: scaleX(1);
}

.interactive-step-card.active {
    border-color: #4a9eff;
    box-shadow: 0 4px 20px rgba(74, 158, 255, 0.2);
}

.interactive-step-card.completed {
    opacity: 0.7;
    border-color: #4a9eff;
}

.interactive-step-card.pending {
    opacity: 0.5;
    border-color: #555;
}

.step-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #333;
}

.step-name {
    font-size: 18px;
    font-weight: 600;
    color: #fff;
    text-transform: capitalize;
}

.step-status {
    font-size: 14px;
    color: #4a9eff;
    font-weight: 500;
}

.step-report {
    margin-bottom: 20px;
}

.step-finding {
    color: #ccc;
    margin: 8px 0;
    font-size: 14px;
    line-height: 1.5;
}

.step-time {
    color: #888;
    font-size: 12px;
    margin-top: 10px;
    font-style: italic;
}

.step-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    margin-bottom: 15px;
}

.route-button {
    background: linear-gradient(135deg, #2a2a2a 0%, #1e1e1e 100%);
    border: 1px solid #444;
    color: #fff;
    padding: 12px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
    text-align: center;
}

.route-button:hover {
    background: linear-gradient(135deg, #4a9eff 0%, #7b68ee 100%);
    border-color: #4a9eff;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(74, 158, 255, 0.3);
}

.route-button:active {
    transform: translateY(0);
}

.auto-advance-indicator {
    text-align: center;
    color: #888;
    font-size: 12px;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #333;
}

.auto-advance-indicator .countdown {
    color: #4a9eff;
    font-weight: 600;
}

/* Smooth transitions */
.interactive-step-card {
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}


/* Phase 6 & 7: Expert Consultations and Interventions - Modern Redesign */
.astro-expert-consultations {
    margin: 4px 0;
    padding: 4px;
    background: transparent;
    border: none;
}

.astro-section-header-compact {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2px;
    padding: 2px 0;
    border-bottom: 1px solid rgba(100, 150, 255, 0.15);
}

.astro-section-header-compact h3 {
    color: #64b5f6;
    margin: 0;
    font-size: 0.75em;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1.2;
}

.expert-count-badge {
    background: rgba(100, 150, 255, 0.2);
    color: #64b5f6;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 0.75em;
    font-weight: 600;
}

.astro-expert-grid-modern {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 2px;
    margin-top: 2px;
}

.astro-expert-card-modern {
    background: rgba(20, 30, 50, 0.3);
    border: 1px solid rgba(100, 150, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
    transition: all 0.2s ease;
}

.astro-expert-card-modern:hover {
    border-color: rgba(100, 150, 255, 0.2);
    background: rgba(20, 30, 50, 0.4);
}

.expert-card-header-modern {
    padding: 3px 4px;
    cursor: pointer;
    user-select: none;
}

.expert-title-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.expert-title-row h4 {
    color: #90caf9;
    margin: 0;
    font-size: 0.7em;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    line-height: 1.1;
}

.expert-toggle-icon {
    color: rgba(255, 255, 255, 0.4);
    font-size: 0.65em;
    transition: transform 0.2s;
}

.expert-card-content-modern {
    padding: 3px 4px;
    border-top: 1px solid rgba(100, 150, 255, 0.08);
    font-size: 0.7em;
    line-height: 1.4;
    color: rgba(255, 255, 255, 0.85);
}

.expert-insights-modern {
    margin-bottom: 3px;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.7em;
    line-height: 1.4;
}

.expert-meta-tags {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 2px;
    margin-top: 2px;
    font-size: 0.65em;
}

.meta-label {
    color: rgba(255, 255, 255, 0.5);
    font-weight: 600;
    margin-right: 2px;
    font-size: 0.65em;
}

.meta-tag {
    background: rgba(100, 150, 255, 0.15);
    color: #90caf9;
    padding: 1px 4px;
    border-radius: 2px;
    font-size: 0.65em;
}

.meta-tag-more {
    color: rgba(255, 255, 255, 0.4);
    font-size: 0.65em;
}

.astro-interventions-modern {
    margin: 4px 0;
    padding: 4px;
    background: transparent;
    border: none;
}

.astro-intervention-content-modern {
    margin-top: 2px;
    padding: 0;
}

.intervention-text-modern-compact {
    font-size: 0.75em;
    line-height: 1.4;
    color: rgba(255, 255, 255, 0.85);
}

.intervention-section-title {
    color: #64b5f6;
    font-size: 0.75em;
    font-weight: 600;
    margin: 0;
    padding: 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1.1;
}

.intervention-subheading {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.7em;
    font-weight: 600;
    margin: 0;
    padding: 0;
    line-height: 1.2;
}

.intervention-para-compact {
    margin: 0;
    padding: 0;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.7em;
    line-height: 1.3;
}

.intervention-list-compact {
    margin: 0;
    padding-left: 12px;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.75em;
}

.intervention-list-compact li {
    margin: 0;
    padding: 0;
    line-height: 1.4;
}

.intervention-empty {
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.75em;
    font-style: italic;
    margin: 0;
    padding: 0;
}

/* Hypotheses - Ultra Compact */
.astro-hypotheses-compact {
    margin: 2px 0;
    padding: 2px;
    background: transparent;
    border: none;
}

.astro-hypotheses-header-compact {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 2px 0;
    border-bottom: 1px solid rgba(138, 43, 226, 0.2);
}

.astro-hypotheses-content-compact {
    margin-top: 2px;
}

.astro-hypotheses-grid-compact {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 2px;
}

.astro-hypothesis-card-compact {
    background: rgba(138, 43, 226, 0.1);
    border-left: 2px solid #8A2BE2;
    padding: 3px 4px;
    border-radius: 2px;
    font-size: 0.7em;
    line-height: 1.3;
}

.astro-intervention-sections {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.astro-intervention-section {
    background: rgba(20, 30, 50, 0.6);
    padding: 16px;
    border-radius: 8px;
    border: 1px solid rgba(100, 150, 255, 0.2);
}

.astro-intervention-section h4 {
    color: #90caf9;
    margin: 0 0 12px 0;
    text-transform: capitalize;
}

.astro-intervention-section pre {
    background: rgba(10, 15, 25, 0.8);
    padding: 12px;
    border-radius: 6px;
    color: #90caf9;
    font-size: 0.85em;
    overflow-x: auto;
    margin: 0;
}

/* Astro-Physiology Animated Streaming Styles */
.astro-typing-container {
    position: relative;
}

.astro-typing-cursor {
    display: inline-block;
    color: #00D4FF;
    font-weight: bold;
    margin-left: 2px;
    animation: astro-cursor-blink 1s infinite;
}

@keyframes astro-cursor-blink {

    0%,
    50% {
        opacity: 1;
    }

    51%,
    100% {
        opacity: 0;
    }
}

.astro-celestial-reveal {
    position: relative;
    overflow: hidden;
}

.astro-glow-effect {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at center, rgba(0, 212, 255, 0.3) 0%, transparent 70%);
    animation: astro-glow-pulse 0.6s ease-out;
    pointer-events: none;
    z-index: 1;
}

@keyframes astro-glow-pulse {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }

    50% {
        opacity: 1;
        transform: scale(1.1);
    }

    100% {
        opacity: 0;
        transform: scale(1);
    }
}

/* Progressive disclosure animations */
.astro-progressive-element {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}

.astro-progressive-element.revealed {
    opacity: 1;
    transform: translateY(0);
}

/* Celestial-style chart reveal */
.astro-chart-wrapper {
    opacity: 0;
    transform: translateY(30px) scale(0.95);
    transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1),
        transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.astro-chart-wrapper.revealed {
    opacity: 1;
    transform: translateY(0) scale(1);
}

/* Stagger animation for multiple elements */
.astro-stagger-1 {
    transition-delay: 0ms;
}

.astro-stagger-2 {
    transition-delay: 200ms;
}

.astro-stagger-3 {
    transition-delay: 400ms;
}

.astro-stagger-4 {
    transition-delay: 600ms;
}

.astro-stagger-5 {
    transition-delay: 800ms;
}

/* Mobile Optimizations for Astro-Physiology Blue Boxes */
@media (max-width: 768px) {

    /* Expert Consultations - Mobile Friendly */
    .astro-expert-consultations {
        margin: 6px 0;
        padding: 6px;
        border-radius: 6px;
    }

    .astro-expert-grid {
        grid-template-columns: 1fr;
        /* Single column on mobile */
        gap: 6px;
        margin-top: 6px;
    }

    .astro-expert-card {
        padding: 6px;
        border-radius: 4px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }

    .astro-expert-header h4 {
        font-size: 0.85em;
        margin: 0 0 4px 0;
    }

    .astro-expert-content {
        font-size: 0.8em;
        line-height: 1.4;
    }

    /* Interventions - Mobile Friendly */
    .astro-interventions {
        margin: 6px 0;
        padding: 6px;
        border-radius: 6px;
    }

    .astro-intervention-tabs {
        flex-wrap: wrap;
        gap: 4px;
        margin-bottom: 6px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    .astro-tab {
        padding: 6px 8px;
        font-size: 0.8em;
        white-space: nowrap;
        flex-shrink: 0;
    }

    .astro-tab-panel {
        padding: 6px 0;
    }

    .astro-intervention-section {
        padding: 6px;
        border-radius: 4px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }

    .astro-intervention-section h4 {
        font-size: 0.85em;
        margin: 0 0 4px 0;
    }

    .astro-intervention-section pre {
        padding: 6px;
        font-size: 0.7em;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* Astro Card - Mobile Optimized */
    .astro-card-header {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 4px;
        margin-bottom: 6px !important;
    }

    .astro-card-header h3 {
        font-size: 0.95em !important;
    }

    .astro-key-insights {
        margin-bottom: 6px !important;
    }

    .astro-key-insights h4 {
        font-size: 0.85em !important;
        margin: 0 0 4px 0 !important;
    }

    .astro-key-insights>div {
        grid-template-columns: 1fr !important;
        gap: 4px !important;
    }

    .astro-key-insights>div>div {
        padding: 6px !important;
        font-size: 0.8em !important;
    }

    .astro-charts-container {
        grid-template-columns: 1fr !important;
        gap: 6px !important;
    }

    .astro-chart-wrapper {
        padding: 6px !important;
        border-radius: 4px !important;
    }

    .astro-chart-wrapper h4 {
        font-size: 0.85em !important;
        margin: 0 0 4px 0 !important;
    }

    .astro-chart-wrapper canvas {
        max-height: 180px !important;
    }

    /* Astro Buttons - Mobile Friendly */
    .astro-expand-btn,
    .astro-collapse-btn,
    .astro-dashboard-btn,
    .astro-expert-btn {
        padding: 6px 8px !important;
        font-size: 0.8em !important;
        white-space: nowrap;
    }

    /* Astro Loading State - Mobile */
    .astro-loading-state {
        padding: 6px !important;
        margin: 6px 0 !important;
        border-radius: 4px !important;
    }

    .astro-loading-state h3 {
        font-size: 0.85em !important;
    }

    .astro-step {
        font-size: 0.8em !important;
        gap: 6px !important;
    }

    /* Astro Birth Form - Mobile */
    .astro-birth-form {
        padding: 12px !important;
        margin: 12px 0 !important;
        border-radius: 8px !important;
    }

    .astro-form-input {
        width: 100% !important;
        padding: 10px !important;
        font-size: 0.875em !important;
        box-sizing: border-box !important;
    }

    .astro-form-button {
        width: 100% !important;
        padding: 10px !important;
        font-size: 0.875em !important;
        margin-top: 8px !important;
    }
}

@media (max-width: 480px) {

    /* Extra small mobile - even tighter */
    .astro-expert-consultations,
    .astro-interventions {
        margin: 8px 0;
        padding: 10px;
    }

    .astro-expert-card,
    .astro-intervention-section {
        padding: 10px;
    }

    .astro-tab {
        padding: 6px 10px;
        font-size: 0.8em;
    }

    .astro-card-header h3 {
        font-size: 1em !important;
    }

    .astro-key-insights>div>div {
        padding: 6px !important;
        font-size: 0.8em !important;
    }

    .astro-chart-wrapper {
        padding: 10px !important;
    }

    .astro-chart-wrapper canvas {
        max-height: 150px !important;
    }
}

/* Tighten Chat Modes on Mobile */
@media (max-width: 768px) {
    .chat-container {
        padding: 0.875rem 0.75rem;
        gap: 1rem;
    }

    .message {
        padding: 0.75rem 0;
        gap: 0.375rem;
    }

    .message.user {
        max-width: 85%;
    }

    .message.assistant {
        max-width: 100%;
        width: 100%;
    }

    /* Tighter action items on mobile */
    .action-item {
        padding: 0.5rem;
        margin: 0.25rem 0;
        border-radius: 6px;
    }

    .action-item-header {
        padding: 0.375rem 0;
    }

    .action-item-content {
        padding: 0.5rem 0;
    }
}

@media (max-width: 480px) {
    .chat-container {
        padding: 0.75rem 0.625rem;
        gap: 0.875rem;
    }

    .message {
        padding: 0.625rem 0;
        gap: 0.25rem;
    }

    .action-item {
        padding: 0.375rem;
        margin: 0.2rem 0;
    }
}

/* ================================================
   AGENT WORKFLOW PILL - Phase 4 UX Enhancement
   Shows which agents are running with pulse animation
   ================================================ */

.agent-workflow-pill {
    position: fixed;
    bottom: 100px;
    /* Above input area */
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: rgba(26, 26, 26, 0.95);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 24px;
    padding: 8px 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    z-index: 500;
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
}

.agent-workflow-pill.visible {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
}

.agent-workflow-pill.hidden {
    opacity: 0;
    transform: translateX(-50%) translateY(20px);
    pointer-events: none;
}

.agent-step {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    transition: all 0.3s ease;
}

.agent-step.active {
    color: rgba(255, 255, 255, 1);
}

.agent-step.completed {
    color: rgba(255, 255, 255, 0.4);
}

.agent-step-icon {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transition: all 0.3s ease;
}

.agent-step.active .agent-step-icon {
    background: rgba(255, 255, 255, 1);
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
    animation: agent-pulse 1.5s ease-in-out infinite;
}

.agent-step.completed .agent-step-icon {
    background: rgba(255, 255, 255, 0.4);
}

.agent-step.completed .agent-step-icon::after {
    content: '✓';
    position: absolute;
    font-size: 6px;
    color: var(--bg-primary);
}

.agent-step-arrow {
    color: rgba(255, 255, 255, 0.2);
    font-size: 0.625rem;
}

@keyframes agent-pulse {

    0%,
    100% {
        transform: scale(1);
        opacity: 0.9;
    }

    50% {
        transform: scale(1.2);
        opacity: 1;
        box-shadow: 0 0 12px rgba(255, 255, 255, 0.8);
    }
}

/* ================================================
   METACOGNITION INDICATORS
   Shows alignment score, contradiction count
   ================================================ */

.metacog-indicators {
    position: fixed;
    bottom: 140px;
    /* Above workflow pill */
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
    z-index: 499;
    opacity: 0;
    transition: all 0.3s ease;
}

.metacog-indicators.visible {
    opacity: 1;
}

.metacog-badge {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    background: rgba(26, 26, 26, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    font-size: 0.6875rem;
    color: rgba(255, 255, 255, 0.7);
}

.metacog-badge.warning {
    border-color: rgba(255, 200, 100, 0.3);
    color: rgba(255, 200, 100, 0.9);
}

.metacog-badge-icon {
    font-size: 0.75rem;
}

.metacog-badge-value {
    font-weight: 500;
}

/* ================================================
   MODE SELECTOR
   Dropdown to choose processing mode
   ================================================ */

.mode-selector {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.mode-selector:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
}

.mode-selector-icon {
    font-size: 0.875rem;
}

.mode-selector-label {
    font-weight: 500;
}

.mode-selector-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    margin-top: 4px;
    background: rgba(26, 26, 26, 0.98);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 4px;
    min-width: 180px;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: all 0.2s ease;
}

.mode-selector:hover .mode-selector-dropdown,
.mode-selector:focus-within .mode-selector-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.mode-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.15s ease;
}

.mode-option:hover {
    background: rgba(255, 255, 255, 0.1);
}

.mode-option.selected {
    background: rgba(255, 255, 255, 0.08);
}

.mode-option-icon {
    font-size: 1rem;
}

.mode-option-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.mode-option-name {
    font-size: 0.8125rem;
    font-weight: 500;
    color: var(--text-primary);
}

.mode-option-desc {
    font-size: 0.6875rem;
    color: var(--text-tertiary);
}

/* Mobile adjustments for workflow */
@media (max-width: 768px) {
    .agent-workflow-pill {
        padding: 6px 12px;
        gap: 6px;
        max-width: 95%;
    }

    .agent-step {
        font-size: 0.6875rem;
    }

    .agent-step-name {
        display: none;
        /* Hide names on mobile, show only icons */
    }

    .metacog-indicators {
        bottom: 130px;
        gap: 8px;
    }

    .metacog-badge {
        padding: 3px 8px;
        font-size: 0.625rem;
    }
}

/* ================================================
   THEME TOGGLE SLIDER
   Toggle switch for light/dark mode
   ================================================ */

.theme-toggle-wrapper {
    position: relative;
    display: inline-block;
}

.theme-toggle-input {
    opacity: 0;
    width: 0;
    height: 0;
    position: absolute;
}

.theme-toggle-slider {
    display: inline-block;
    width: 48px;
    height: 24px;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.theme-toggle-slider::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 18px;
    height: 18px;
    background: var(--text-primary);
    border-radius: 50%;
    transition: all 0.3s ease;
}

.theme-toggle-input:checked+.theme-toggle-slider {
    background: var(--accent-primary);
}

.theme-toggle-input:checked+.theme-toggle-slider::before {
    transform: translateX(24px);
}